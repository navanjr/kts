create function dbo.receiptDetailGLDetailId(@receiptDetailId int) returns int
as
begin
declare @slink varchar(16),
        @description varchar(100),
        @fundcode varchar(60),
        @sourcecode varchar(60),
        @gldetailid int
        
select @slink=slink, @description=[description], @fundcode=fundCode, @sourcecode=sourcecode from receiptdetail where id=@receiptDetailId

select @gldetailid = id from gldetail where slink=@slink and sourcecode=@sourcecode and comment=@description 
  and accountCode in (select @fundcode union all select accountCode from glAccounts where accountType='Accrued Receivable' and targetAccountCode=@fundcode)
return @gldetailId
end