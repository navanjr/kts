create proc dbo.apiDeletedProc(
 @styp varchar(1),
 @id int,
 @apiResource varchar (50)
) as 
begin

 declare
  @slink varchar(15) = @styp + cast(@id as varchar),
  @blob varchar(max)
 
 if exists (select * from apideleted where slink = @slink)
 begin
  exec dbo.logit @@procid, 'Already exists... @slink', @slink, '@apiResource', @apiResource
  return
 end

-- it is ok if @blob ends up being null if there is no link to a Tax invoice... that just means the api won't have it anyhow.
 if @apiResource = 'receipts'
  begin
  insert apiDeleted(slink,apiResource,blob) 
   select @slink, @apiResource, 'receipt_link=' + cast(@id as varchar) + ';invoice_link=' + cast(abs(invoiceId) as varchar) + ';'
   from receiptLink with (NOLOCK) where abs(receiptId) = @id

   exec dbo.logit @@procid, 'inserted into apiDeleted... @slink', @slink, '@apiResource', @apiResource, '@blob', @blob 

   return
  end

 if @apiResource = 'invoices'
  select @blob = 'invoice_link=' + cast(abs(@id) as varchar) + ';'

 insert apiDeleted(slink,apiResource,blob) select @slink, @apiResource, @blob

 exec dbo.logit @@procid, 'inserted into apiDeleted... @slink', @slink, '@apiResource', @apiResource, '@blob', @blob

end