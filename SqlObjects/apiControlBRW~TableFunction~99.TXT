create function dbo.apiControlBRW() returns @rt table(
 id int identity(-1,-1),
 resource varchar(50),
 total int,
 stale int,
 rate money,
 blob varchar(1000),
 ord varchar(50)
) as
begin

 insert @rt select 'tax_rolls', count(*), sum(case when modified > isnull(apiUpdated,0) then 1 else 0 end), null, '@resource=taxrolls;', 'a' from adtax
 insert @rt select 'legal', count(*), sum(case when modified > isnull(apiUpdatedLegal,0) then 1 else 0 end), null, '@resource=legal;', 'a' from adtax where cast(legalDescription as varchar(8000)) > '  0'
 insert @rt select 'invoices', count(*), sum(case when modified > isnull(apiUpdated,0) then 1 else 0 end), null, '@resource=invoices;', 'b' from invoices where taxrollid > 0

 update @rt set rate = ( (total - cast(stale as money))  / total ) * 100.0
 return
end