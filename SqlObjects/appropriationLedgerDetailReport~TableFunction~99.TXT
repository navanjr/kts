create function dbo.appropriationLedgerDetailReport(@begindate varchar(20),@enddate varchar(20)) 
returns @rt table(FundDesc varchar(60),
                  accountNumber varchar(60),
                  detailDate int,
                  person varchar(60),
                  purpose varchar(60),
                  warrants varchar(50),
                  budget varchar(50),
                  balance varchar(50),
                  ord varchar(250),
                  fiscalYear varchar(20))
as
begin
           
insert @rt
 select 
  fundDesc,
  accountNumber,
  0,
  '',
  '',
  SUM(payments),
  SUM(budget),
  sum(balance),
  right(fiscalYear,2)+left(fundDesc,6)+left(accountnumber,20)+'bbb',
  fiscalYear
  from dbo.appropriationLedgerDetail(@begindate,@enddate) group by fiscalYear,funddesc,accountNumber


insert @rt
  select 
  fundDesc,
  '',
  0,
  '',
  '',
  SUM(cast(warrants as money)),
  SUM(cast(budget as money)),
  sum(cast(balance as money)),
  right(fiscalYear,2)+left(fundDesc,6)+'zzzzz'+'ccc',
  fiscalYear from @rt group by fiscalYear,FundDesc

insert @rt
 select 
  fundDesc,
  accountNumber,
  detailDate,
  person,
  purpose,
  payments,
  budget,
  balance,
  right(fiscalYear,2)+left(fundDesc,6)+accountnumber+'bba',
  fiscalYear
  from dbo.appropriationLedgerDetail(@begindate,@enddate) 



insert @rt (FundDesc,accountNumber,ord,fiscalyear)
  select 
  fundDesc,
  '',
  right(fiscalYear,2)+left(fundDesc,6)+'     '+'aaa',fiscalyear from @rt group by fiscalYear,FundDesc

insert @rt (FundDesc,accountNumber,ord,fiscalyear)
  select 
  'Fiscal Year: '+fiscalYear,
  '',
  right(fiscalYear,2)+'          '+'aa1',fiscalyear from @rt group by fiscalYear


update @rt
  set
  warrants = dbo.formatcurr(warrants),
  budget = dbo.formatcurr(budget),
  balance = dbo.formatcurr(balance)
                  

return
end     
