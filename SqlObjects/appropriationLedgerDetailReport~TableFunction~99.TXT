create function dbo.appropriationLedgerDetailReport(@begindate varchar(20),@enddate varchar(20),@activeOnly varchar(5),@noBalance varchar(5)) 
returns @rt table(FundDesc varchar(60),
                  accountNumber varchar(60),
                  detailDate int,
                  person varchar(60),
                  purpose varchar(60),
                  warrants varchar(50),
                  budget varchar(50),
                  balance varchar(50),
                  ord varchar(250),
                  fiscalYear varchar(20),
                  origin int)
as
begin
           
insert @rt
 select 
  fundDesc,
  accountNumber,
  0,
  '',
  '',
  SUM(payments),
  SUM(budget),
  sum(balance),
  right(fiscalYear,2)+dbo.padRight(fundDesc,' ',20)+dbo.padRight(accountnumber,' ',20)+'bbb',
  fiscalYear,
  1
  from dbo.appropriationLedgerDetail(@begindate,@enddate,@activeOnly,@noBalance) group by fiscalYear,funddesc,accountNumber


insert @rt
  select 
  fundDesc,
  '',
  0,
  '',
  '',
  SUM(cast(warrants as money)),
  SUM(cast(budget as money)),
  sum(cast(balance as money)),
  right(fiscalYear,2)+left(fundDesc,20)+'zzzzz'+'ccc',
  fiscalYear,
  2
  from @rt group by fiscalYear,FundDesc

insert @rt
 select 
  fundDesc,
  accountNumber,
  detailDate,
  person,
  purpose,
  payments,
  budget,
  balance,
  right(fiscalYear,2)+dbo.padRight(fundDesc,' ',20)+dbo.padRight(accountnumber,' ',20)+'bba',
  fiscalYear,
  3
  from dbo.appropriationLedgerDetail(@begindate,@enddate,@activeOnly,@noBalance) 



insert @rt (FundDesc,accountNumber,ord,fiscalyear,origin)
  select 
  fundDesc,
  '',
  right(fiscalYear,2)+dbo.padRight(fundDesc,' ',20)+dbo.padRight('',' ',20)+'aaa',fiscalyear,4 
  from @rt group by fiscalYear,FundDesc

insert @rt (FundDesc,accountNumber,ord,fiscalyear,origin)
  select 
  'Fiscal Year: '+fiscalYear,
  '',
    right(fiscalYear,2)+dbo.padRight('',' ',20)+dbo.padRight('',' ',20)+'aa1',fiscalyear,5 from @rt group by fiscalYear


update @rt
  set
  warrants = dbo.formatcurr(warrants),
  budget = dbo.formatcurr(budget),
  balance = dbo.formatcurr(balance)
                  

return
end     
