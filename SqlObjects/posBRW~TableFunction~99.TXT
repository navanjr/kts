create function dbo.posBRW() returns @rt table(
 id int,
 receiptType varchar(50),
 paycode varchar(50),
 accountCode varchar(50),
 amount money,
 accountId int
) as 
begin

 declare
  @posName varchar(50)

 select @posName = dbo.readString('@posName=',dbo.whoAmI())

 insert @rt
 select 0,a.key1,b.key1,@posName + '.' + a.key1 + '.' + b.key1, 0, 0
 from object a, object b
 where a.typ = 4503 and b.typ = 4505
  and a.key1 > '  0'
  and b.key1 > '  0'

 update a set a.accountId = o.accountId from @rt a, dbo.glAccounts o where a.accountCode = o.accountCode

 update a set amount = (select sum(g.amount) from dbo.glDetail g where g.accountCode = a.accountcode) 
 from @rt a
 where
--  a.accountCode in (select accountCode from dbo.glDetail)
  a.accountid > 0

 return
end