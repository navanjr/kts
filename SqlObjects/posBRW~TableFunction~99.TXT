create function dbo.posBRW() returns @rt table(
 id int,
 receiptType varchar(50),
 paycode varchar(50),
 accountCode varchar(50),
 amount money
) as 
begin

 declare
  @suspenseMethod varchar(50),
  @name varchar(50)

 select @suspenseMethod = suspenseMethod from dbo.site

 if @suspenseMethod = 'S'
  select @name = dbo.splitF(dbo.whoAmI(),'|',2)
 else
  select @name = dbo.splitF(dbo.whoAmI(),'|',1)


 insert @rt
 select 0,a.key1,b.key1,@name + '.' + a.key1 + '.' + b.key1, 0
 from object a, object b
 where a.typ = 4503 and b.typ = 4505
  and a.key1 > '  0'
  and b.key1 > '  0'

 update a set amount = (select sum(g.amount) from dbo.glDetail g where g.accountCode = a.accountcode) 
 from @rt a
 where a.accountCode in (select accountCode from dbo.glDetail)

 return
end