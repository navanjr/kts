create function dbo.targetFund(@accountcode varchar(60))
returns @rt table(accountCode varchar(50),apportionPercent money, accountDesc varchar(50))
as
begin

declare @accountType varchar(60),@accountId int

select @accountType=accountType,@accountId=accountId from dbo.glaccounts where accountCode=@accountcode

if @accountType in (select accountType from dbo.glbankfundtypes('FUND'))
select @accountType=accountType,@accountId=accountId from dbo.glaccounts where targetaccountCode=@accountcode and accounttype='ACCRUED RECEIVABLE'


if @accountType='ACCRUED RECEIVABLE'
begin
 insert @rt
 select creditcode,amount,'' from dbo.apportionCollectionsWT( @accountId, 0, 'TRUE', null, null) where creditcode in (select accountcode from glaccounts where  accountType in (select accountType from dbo.glbankfundtypes('FUND')))
end

if @accounttype in ('WARRANT')
begin
 insert @rt
 select t.accountcode,0,t.accountdesc from glaccounts a, glaccounts t where a.accountcode=@accountcode and t.accountcode=a.targetaccountcode
end

update r set accountDesc = a.accountDesc from @rt r, glaccounts a where r.accountcode=a.accountcode

return
end
