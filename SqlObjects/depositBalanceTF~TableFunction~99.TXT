create function dbo.depositBalanceTF(@d1 int,@d2 int,@deputy varchar(50),@depositId int,@station varchar(50),@recTyp varchar(50)) returns @rt
		table (	receivedOf varchar(60),
			Amount varchar(50),
			ref varchar(50),
			bankRef varchar(100),
			paycode varchar(50),
			recTyp varchar(50),
			recNo varchar(50),
			Deputy varchar(50),
			ord varchar(50))
as
begin


insert @rt
select   
     receiptType+': '+receiptNo,
     amount,
     paycode+' '+checkno,
     rtrim(drawnon)+case when drawnon>'  0' then ' / ' else '' end+location,    
     case when paycodeDepositType>'  0' then case when paycodeDepositType='E' then 'ETR' else 'CCard' end else paycode end,
     receiptType,
     receiptNo,
     case when @station!='0' then station else deputy end,
     deputy+receiptType+'bbb'
     from dbo.depositAvailablePayments where 
     isnull(depositId,0) = case when @depositId!=0 then @depositId else isnull(depositId,0) end 
     and deputy like case when @deputy!='0' then '%'+@deputy+'%' else deputy end 
     and station like case when @station!='0' then @station else station end
     and receiptType = case when @recTyp!='0' then @recTyp else receiptType end
     and receiptPostDate between @d1 and @d2
     order by receiptType, deputy, paycode, receiptNo


insert @rt (receivedOf,ord)
	select  '',Deputy+recTyp+'bbbccc'
	from @rt  where RIGHT(ord,3)='bbb' group by deputy,recTyp
         
insert @rt (receivedOf,ref,Amount,ord)
	select Deputy+' '+paycode,'',SUM(cast(amount as money)),Deputy+recTyp+paycode+'ccc1'
	from @rt  where RIGHT(ord,3)='bbb' group by deputy,paycode,recTyp

insert @rt (receivedOf,ref,Amount,ord)
	select Deputy+' Total','',SUM(cast(amount as money)),Deputy+recTyp+'zzzzccc3'
	from @rt  where RIGHT(ord,3)='bbb' group by deputy,recTyp		
		

insert @rt (receivedOf,ref,Amount,ord)
	select paycode,'',SUM(cast(amount as money)),'zzz'+paycode+'ddd1'
	from @rt  where RIGHT(ord,3)='bbb' group by paycode	
	
insert @rt (receivedOf,ref,Amount,ord)
	select 'Report Total','',SUM(cast(amount as money)),'zzzzeee'
	from @rt  where RIGHT(ord,3)='bbb' 	
         

  return 
 end   
