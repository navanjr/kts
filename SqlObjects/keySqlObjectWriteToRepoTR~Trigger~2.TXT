create TRIGGER dbo.keySqlObjectWriteToRepoTR ON dbo.object
AFTER INSERT, UPDATE 
AS

 if (@@ROWCOUNT = 0)
  return

-- bail if more than one records were inserted
 if (select count(*) from inserted) > 1
  return

 declare
  @typ int,
  @objectId int,
  @slink varchar(15)

 declare @allowedObjectTyps table(typ int)
 insert @allowedObjectTyps
  select 451
  union select 4502
  union select 4522
  union select 4771
  union select 4512
  union select 4513

 select
  @typ = typ,
  @objectId = id,
  @slink = 'o' + cast(id as varchar)
 from inserted

-- bail if the one record inserted is not in our list of approved types
 if not @typ in (select typ from @allowedObjectTyps)
  return

 if @objectId > 0 and @typ = 451
 begin
  exec dbo.keySQLObjectWriteToRepo @objectId
  return
 end

-- bail if the glDetailSync is off
 if (select dbo.settingsF('site.glDetailSync','FALSE')) = 'FALSE'
  return

 if @objectId > 0 and @typ in (select typ from @allowedObjectTyps) and update(key2)
 begin
  update a
   set a.date = b.key2
  from dbo.glDetail a, inserted b
  where a.slink = 'o' + cast(b.id as varchar)
  exec dbo.logit @@procId, 'Just Updated... @@rowCount', @@rowCount, '@typ', @typ
 end