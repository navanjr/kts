create function dbo.auditorReportCollections(@theDate varchar(15),@days int,@ordSeed varchar(10)) 
	returns @rt table(
			auditorReportGroup varchar(50),
			rowstring varchar(250),
			sourceAmt varchar(50),
			rowType char(10),
			ord varchar(250)
			)
as 
begin
declare @wt table(
			auditorReportGroup varchar(50),
			auditReportGroup varchar(60),
			apportionOut money,
			reportOrder varchar(60))

declare @wtdetail table(auditorReportGroup varchar(60),
						auditReportGroup varchar(60),
						amount money,
						reportOrder varchar(60))
						
declare @wttypes table(sourceType varchar(60),
						auditorReportGroup varchar(60),
						detail varchar(60))

insert @wttypes
	select * from dbo.journalTypes()
insert @wttypes
	select * from dbo.paymentTypes()

insert @wtdetail
	select 
		auditorReportGroup,
		case when auditReportGroup > ' 0' then auditReportGroup else accountDesc end,
		amount,
		reportOrder
	from gldetailreports g, @wttypes w
  where sourceDate between cast(@theDate as varchar) and cast(@theDate + @days as varchar)
	and accountType in (select accountType from dbo.glBankFundTypes('FUND'))
	and accountCode in (select accountCode from glaccounts where bsSummary like '%Ad V%')
	and g.sourcea18 = w.sourceType
	and auditorReportGroup = 'Collections'

insert @wt
	select 
		auditorReportGroup,
		auditReportGroup,
		sum(amount),
		cast(max(reportOrder) as varchar)
	from @wtdetail 
	group by auditorReportGroup,auditReportGroup

insert @rt
 select 
 auditorReportGroup,
 '   ' + dbo.padRight(auditReportGroup,' ',61),
 dbo.padLeft(dbo.formatCurr(apportionOut),' ',16),
 'detail',
 @ordSeed + cast(reportOrder as varchar) + 'b'
 from @wt
----insert subtotals
insert @rt
	select 
            '',
            dbo.padRight('      Total ' + auditorReportGroup, ' ', 60),
            dbo.padLeft(dbo.formatCurr(SUM(apportionOut)),' ',16),
            'gFooter',
            @ordSeed + max(reportOrder) + 'd' 
	from @wt group by auditorReportGroup

insert @rt 
	select replicate('=',22),' ' + replicate('=',79),replicate('=',16),'line',@ordSeed + max(reportOrder) + 'c' from @wt

----headers
insert @rt 
	select '','','','lineFeed',@ordSeed + '0000a'
insert @rt (rowstring,ord,rowType)
	select '  '+max(auditorreportgroup),@ordSeed + '0000aa','sHeader'	from @wt
insert @rt 
	select replicate('=',22),' ' + replicate('=',79),replicate('=',16),'line',@ordSeed + '0000ab'

return
end	
	
	
/*
--select dbo.clariondate('20121101')
	declare
		@theDate int = 77375,
		@days int = 30
		select * from dbo.auditorReportCollections(@theDate,@days,'A') order by ord
*/