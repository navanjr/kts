create function dbo.docBatchBRW(
 @batchBRWId int, -- this parameters first character is either a 9(documentProcessing) or 8(comments)
 @documentName varchar(50) = null,
 @processCode varchar(50) = null
) returns @rt table(
 invoiceId int,
 name nvarchar(60),
 printOrder varchar(50),
 parcel nvarchar(34),
 taxYear numeric(5,0),
 item numeric(22,1),
 taxType nvarchar(1),
 amount money,
 due money,
 slink varchar(15),
 selectedFlag char(4),
 methodRate money,
 ord varchar(80),
 fees money,
 penalty money,
 toPay money,
 treamort varchar(5),
 taxrollId int,
 queue varchar(50),
 printed varchar(50),
 origin int,
 documentDate int
) as
begin

 declare 
  @idSwitch int,
  @batchId int
 
 if @batchBRWId > 0
  select 
   @documentName = documentName,
   @processCode = processCode
  from dbo.docBRWDecoder(@batchBRWId)

-- document processing 
 insert @rt (invoiceId, name, parcel, taxyear, item, taxType, amount, due, treamort, printed, printOrder, taxrollId, origin, documentDate)
 select i.id, i.name, i.parcel, i.taxYear, i.item, i.typ, i.invoiceAmount, i.invoiceDue, coalesce(a.treamort,cast(a.mortgageCode as varchar)), '', d.printOrder, i.taxrollId, 1, d.documentDate
 from documentProcessing d
 join invoices i on d.invoiceId = i.id
 left outer join adtax a on i.taxrollId = a.id
 where
  documentName = @documentName
  and processCode = @processCode

-- insert @rt (ord, display, count1) select 'c' + processCode, '   ' + processCode, count(*)

-- completed batches
 insert @rt (invoiceId, name, parcel, taxyear, item, taxType, amount, due, treamort, printed, printOrder, taxrollId, origin, documentDate)
 select i.id, i.name, i.parcel, i.taxYear, i.item, i.typ, i.invoiceAmount, i.invoiceDue, coalesce(a.treamort,cast(a.mortgageCode as varchar)), d.documentDateTime, d.printOrder, i.taxrollId, 2, dbo.clarionDate(d.documentDateTime)
 from taxrollDetail d
 join invoices i on d.invoiceLinkId = i.id
 left outer join adtax a on i.taxrollId = a.id
 where
  d.documentName = @documentName
  and d.stamp = @processCode

 return
end
