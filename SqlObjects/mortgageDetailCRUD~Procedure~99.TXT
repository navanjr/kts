create procedure dbo.mortgageDetailCRUD(
 @mode int,
 @receiptId int,
 @receiptTyp int

) as
begin
 exec dbo.logit @@procid, '@mode',@mode

 if @mode = 3
 begin
  -- bail if we are posted
  if (select status from receiptCheck(@receiptId,null)) = 'Posted'
  begin
   exec dbo.logit @@procid, '@code=1;@message=Sorry, receipt is already posted. can not delete this item.  @object_id', @receiptTyp
   return
  end
  
  update object set typ = -4507 where typ = 4507 and id = @receiptTyp -- hijacked this variable for deleting mortgage detail record
  delete from mortgageInfo where receiptId = @receiptId

 end

 if @mode = 0 or @mode = 1
 begin
  declare 
   @MortgageNameId int,
   @mortgagor varchar(100),
   @mortgagee varchar(100),
   @description varchar(100),
   @section varchar(100),
   @township varchar(100),
   @range varchar(100),
   @lender varchar(100)

 -- retrieve the specifics from the mortgageInfo in object
  select
   @MortgageNameId = link4,
   @mortgagor = c1,
   @mortgagee = c2,
   @description = c3,
   @section = c4,
   @township = c5,
   @range = c6,
   @lender = c7
  from object where typ = @receiptTyp and id = @receiptId

  if isnull(@MortgageNameId,0) = 0
  begin
   insert mortgageInfo (receiptId,mortgagor,mortgagee,description,section,township,range,lender) 
    select
     @receiptId,
     @mortgagor,
     @mortgagee,
     @description,
     @section,
     @township,
     @range,
     @lender
   end
  else
   begin 
   update mortgageInfo set 
     mortgagor = @mortgagor,
     mortgagee = @mortgagee,
     description = @description,
     section = @section,
     township = @township,
     range = @range,
     lender = @lender
    where id = @MortgageNameId
   end
 end

end