create function dbo.appropriationLedger(@begindate varchar(20),@enddate varchar(20),@activeOnly varchar(5),@noBalance varchar(5)) 
returns @rt table(FundDesc varchar(60),
                  accountNumber varchar(60),
                  warrants varchar(50),
                  budget varchar(50),
                  balance varchar(50),
                  ord varchar(250),
                  fiscalYear varchar(20))
as
begin
 
insert @rt
 select 
  fundDesc,
  accountNumber,
  SUM(payments),
  SUM(budget),
  sum(balance),
  left(right(fiscalYear,2)+rtrim(fundDesc)+rtrim(accountnumber),45)+'bbb',
  fiscalYear
  from dbo.appropriationLedgerDetail(@begindate,@enddate,@activeOnly,@noBalance) group by right(fiscalYear,2),fiscalYear,funddesc,accountNumber

insert @rt
  select 
  fundDesc,
  '',
  SUM(cast(warrants as money)),
  SUM(cast(budget as money)),
  sum(cast(balance as money)),
  left(right(fiscalYear,2)+rtrim(fundDesc)+'zzzzz',45)+'ccc',
  fiscalYear from @rt group by right(fiscalYear,2),fiscalYear,FundDesc

insert @rt (FundDesc,ord,fiscalyear)
  select 
  fundDesc,
  left(right(fiscalYear,2)+rtrim(fundDesc)+'     ',45)+'aaa',fiscalyear from @rt group by right(fiscalYear,2),fiscalYear,FundDesc

insert @rt (FundDesc,ord,fiscalyear)
  select 
  'Fiscal Year: '+fiscalYear,
  left(right(fiscalYear,2)+'          ',45)+'aa1',fiscalyear from @rt group by right(fiscalYear,2),fiscalYear


update @rt
  set
  warrants = dbo.formatcurr(warrants),
  budget = dbo.formatcurr(budget),
  balance = dbo.formatcurr(balance)
                  

return
end     
