create function dbo.settingsF(
 @settingName varchar(50),
 @returnIfNull varchar(50)
) returns varchar(150) as
begin

 declare @retvar varchar(150)

 if not @settingName in ('site.apiurl','site.apikey','site.apisitecode')
 begin
  select @retvar = settingValue from settings where settingName = @settingName
 end
 else
 begin

  if @settingName = 'site.apiurl'
   select @retvar = apiurl from dbo.site

  if @settingName = 'site.apikey'
   select @retvar = apikey from dbo.site

  if @settingName = 'site.apikey'
   select @retvar = apisitecode from dbo.site

 end

 return isnull(@retvar,@returnIfNull)

end