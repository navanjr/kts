create function dbo.targetFundInvoice(@invoiceId int) returns @rt table(accountCode varchar(50),apportionPercent money) 
as
begin 
declare @fundCode varchar(50),
        @slink varchar(16) = 't'+cast(@invoiceId as varchar)

select top 1 @fundCode=fundcode from receiptdetail with (NOLOCK) where 
 slink=@slink
 order by amount desc

insert @rt
 select accountCode,apportionpercent from dbo.targetFund(@fundCode) order by apportionpercent desc


return
end
