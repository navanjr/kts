create proc dbo.apiJobs (
 @resource varchar(50),
 @method varchar(50) = 'create'
) as
begin

 declare
  @jobId BINARY(16),
  @jobName nvarchar(1000) = 'apiJob_' + @resource,
  @jobSQL nvarchar(1000) = 'exec dbo.api' + @resource + ' @method = ''job''',
  @dbName nvarchar(1000) = db_name(),
  @serverName nvarchar(1000) = @@servername,
  @jobStatus int,
  @taskName varchar(max) = 'api' + @resource,
  @command varchar(max) = 'kts api api' + @resource

 if @method = 'toggle'
 begin

-- if not found run again with a @method = create else call with a @method = delete
  If not exists(select * from scheduledTasks where name like '%' + @taskName)
   exec dbo.apiJobs @resource, 'create'
  else
   exec dbo.apiJobs @resource, 'delete'

 end

 if @method = 'create' 
 begin

  exec dbo.scheduledTasksControl
   @method = @method,
   @name = @taskName,
   @frequency = 'minute',
   @time = 5,
   @command = @command

 end

 if @method = 'delete' 
 begin

  exec dbo.scheduledTasksControl
   @method = @method,
   @name = @taskName

 end
 
end