create function dbo.invoiceGlDetailBRW(@slink varchar(15), @showGL int) returns 
@rt table(
 ord varchar(250),
 id int,
 description varchar(250), 
 subdescription varchar(250), 
 amount money,
 slink varchar(16) 
)
begin
 declare @invoiceId int
 select @invoiceId = cast(right(@slink,len(@slink)-1) as int)

 insert @rt
 select 'aa',cast('9'+cast(id as varchar) as int)*-1,description,lower(subDescription),amount,slink from receiptDetail 
   where slink in (select slink from dbo.invoiceSLinks(@invoiceId)) 

 if exists(select * from dbo.paid where slink in (select slink from dbo.invoiceSLinks(@invoiceId)) )
 begin
  insert @rt
  select 'ba',0,'','',0,''
  insert @rt
  select 'bb',0,'Payment(s)','',0,''
  insert @rt
  select 'bc',cast('8'+cast(id as varchar) as int)*-1,'   '+paycode,checkno,amount*-1,slink from dbo.paid where slink in (select slink from dbo.invoiceSLinks(@invoiceId)) 
 end

 if @showGl = 1
 begin
  if exists(select * from dbo.glDetailStage where slink in (select slink from dbo.invoiceSLinks(@invoiceId)) )
  begin
   insert @rt
   select 'ca',0,'','',0,''
   insert @rt
   select 'cb',0,'GL Detail (staged)','',0,''
   insert @rt
   select 'cc',0,'   '+a.accountDesc,lower(b.accountType),a.amount,slink
   from dbo.glDetailStage a, glaccounts b where a.accountId = b.accountId and a.slink in (select slink from dbo.invoiceSLinks(@invoiceId)) 
  end

  if exists(select * from dbo.glDetail where slink in (select slink from dbo.invoiceSLinks(@invoiceId)) )
  begin
   insert @rt
   select 'ca',0,'','',0,''
   insert @rt
   select 'cb',0,'GL Detail (posted)','',0,''
   insert @rt
   select 'cc'+b.subord,0,'   '+a.accountDesc,lower(b.accountType),a.amount,slink
   from dbo.glDetail a, glaccounts b where a.accountId = b.accountId and a.slink in (select slink from dbo.invoiceSLinks(@invoiceId)) 
  end

 end

 return
end