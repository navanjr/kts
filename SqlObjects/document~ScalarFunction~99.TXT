CREATE function [dbo].[Document](@blah int,@rId int) returns varchar(max)
as begin

declare
  @x varchar(max),
  @date varchar(50),
  @taxPayer varchar(10),
  @address varchar(50),
  @year varchar(50),
  @publishDate varchar(50),
  @Paper varchar(50),
  @addFee varchar(50),
  @advertDate varchar(50),
  @lienFee varchar(50),
  @taxAssessed varchar(50),
  @taxUnpaid varchar(50),
  @intPen varchar(50),
  @backTax varchar(50),
  @TotalDue varchar(50),
  @treasurer varchar(50),
  @county varchar(50),
  @siteBlob varchar(4000),
  @TaxInvoiceBlob varchar(8000),
  @newMessage varchar(8000)
  
  select @siteBlob=dbo.GetSiteBlob(0),@TaxInvoiceBlob=dbo.getTaxInvoiceBlob(@rId)
    
select 
  @date =  datename(month,GETDATE())+' '+cast(DATEPART(DAY,getdate()) as varchar(5))+',  '+cast(DATEPART(Year,getdate()) as varchar(5)),
  @taxPayer = dbo.readstring('@NAME=',@TaxInvoiceBlob),
  @address = dbo.parseAddress(@TaxInvoiceBlob),
  @year = dbo.readstring('@TAXYEAR=',@TaxInvoiceBlob),
  @publishDate = '',
  @Paper = '',
  @addFee = '',
  @advertDate = '',
  @lienFee = '',
  @taxAssessed = '',
  @taxUnpaid = '',
  @intPen = '',
  @backTax = '',
  @TotalDue = '',
  @treasurer = dbo.readstring('@OfficialName=',@siteBlob),
  @county = dbo.readstring('@county=',@siteBlob)
  


select 
	@newMessage = e1
	from Object
	where Typ=4900

	set @newMessage = REPLACE(@newMessage,'{Date}',@date)
	set @newMessage = REPLACE(@newMessage,'{taxPayer}',@taxPayer)
	set @newMessage = REPLACE(@newMessage,'{Address}',@address)
	set @newMessage = REPLACE(@newMessage,'{year}',@year)
	set @newMessage = REPLACE(@newMessage,'{publishDate}',@publishDate)
	set @newMessage = REPLACE(@newMessage,'{advertDate}',@advertDate)
	set @newMessage = REPLACE(@newMessage,'{intPen}',@intPen)
	set @newMessage = REPLACE(@newMessage,'{backTax}',@backTax)
	set @newMessage = REPLACE(@newMessage,'{TotalDue}',@TotalDue)
	set @newMessage = REPLACE(@newMessage,'{treasurer}',@treasurer)
	set @newMessage = REPLACE(@newMessage,'{county}',@county)

set @x = @newMessage

return @x

end



