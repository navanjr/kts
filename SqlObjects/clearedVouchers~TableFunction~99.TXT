create function dbo.clearedVouchers(@beginDate int,@endDate int,@official varchar(50)) 
 returns
  @rt table(
   voucher varchar(50),
   voucherDate Varchar(50),
   registerNum varchar(50),
   regDate varchar(50),
   amountPaid varchar(50),
   amountCredit varchar(50),
   toWhom varchar(50),
   bank varchar(50),
   fund varchar(50),
   comments varchar(500),
   dateCleared varchar(50),
   ord varchar(200))
 as 
begin

insert @rt
 select
    dbo.popro6(clerksNumber,6,1),
    dbo.date2(clerksDate),
    dbo.popro6(treasurersNumber,6,1),
    dbo.date2(dateRegistered),    
    case when amount>0 then amount else 0 end,  
    case when amount<=0 then amount*-1 else 0 end,  
    payee,
    creditAccountDesc,
    debitAccountDesc,
    cast(comment as varchar(100)),
    dateCleared,
    dateCleared+debitAccountDesc+dbo.popro6(clerksNumber,6,1)+'b' 
      from dbo.payments where paymentType like '%VOUCHER%' and slink in 
      (select slink from gldetailreports where accountType in (select accountType from dbo.glBankFundTypes('BANK')) 
      and bsId > 0 and dateCleared between @beginDate and @endDate)
      order by dateCleared,debitAccountDesc, dbo.popro6(clerksNumber,6,1)

if @official>'  0'
  delete from @rt where fund not in (select b2 from object where typ=4601 and key2=@official)


insert @rt (regDate,amountPaid,amountCredit,ord)
 select 
   fund+' Total:',
    cast(SUM(cast(amountPaid as money)) as varchar),
    cast(SUM(cast(amountCredit as money)) as varchar),
    dateCleared+fund+'c' from @rt where RIGHT(ord,1)='b' group by datecleared,fund

insert @rt (regDate,amountPaid,amountCredit,ord)
 select 
   'Cleared '+dbo.date1(dateCleared)+' Total:',
    cast(SUM(cast(amountPaid as money)) as varchar),
    cast(SUM(cast(amountCredit as money)) as varchar),
    dateCleared+'zzzzz'+'d' from @rt  where RIGHT(ord,1)='b' group by dateCleared

insert @rt (regDate,amountPaid,amountCredit,ord)
 select 
   'Report Total:',
    cast(SUM(cast(amountPaid as money)) as varchar),
    cast(SUM(cast(amountCredit as money)) as varchar),
    'zzzzz'+'e' from @rt  where RIGHT(ord,1)='b'


insert @rt (voucher,ord)
 select 
   'Cleared Date: '+dbo.date1(dateCleared),
    dateCleared+'     '+'a' from @rt  where RIGHT(ord,1)='b' group by dateCleared

update @rt
 set amountPaid = dbo.formatcurr(amountPaid),
     amountCredit = dbo.formatcurr(amountCredit)

return
end