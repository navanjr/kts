create view dbo.taxReceipt as

select 
 a.ID recId,
 b.id as linkId,
 c.id as invoiceId,
 b.receiptNumber recNum,
 a.Key2 postDate,
 dbo.date1(a.key2) postdate1,
 a.b10 recDate,
 dbo.date1(a.b10) recdate1,
 a.key3 recType,
 a.A1 recFrom,
 a.A17 recStatus,
 a.A18 Deputy,
 a.A19 Official,
 a.D1 comments,
 c.invoiceId as parentInvoiceId,
 c.[typ] as invoiceType,
 a.b13 as station,
 c.taxyear,
 isnull((select top 1 paycode from paid where slink='o'+cast(a.id as varchar) order by amount desc),'') as paycode
 from Object a with (NOLOCK), receiptlink b with (NOLOCK), invoices c with (NOLOCK)
 where a.Typ=4502
  and b.receiptId=a.id
  and b.invoiceId = c.id


