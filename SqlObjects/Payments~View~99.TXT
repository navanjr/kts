create view dbo.payments as

select 
 id,
 typ,
 key1 as treasurersNumber,
 key2 as dateRegistered,
 key3 as clerksNumber,
 a1 as clerksDate,
 ltrim(a2) as payee,
 isnull((select sum(amount) from gldetail where slink='o' + cast(object.id as varchar) and accountCode=object.a4),0) as amount,
 a4 as debitAccountCode,
 b3 as debitAccountDesc,
 a5 as creditAccountCode,
 b4 as creditAccountDesc,
 a6 as purposeAccountCode,
 b5 as purposeAccountDesc,
 a7 as official,
 a8 as depositAccountCode,
 a9 as bankAccountCode,
 c9 as detailAmount,
 a17 as status,
 a18 as paymentType,
 a19 treasurersWarrant,
 a20 as printStatus,
 e1 as comment,
 link1 as warrantLinkId,
 case when a18 = 'WARRANT' then a4 else a8 end as dailyDataAccountLinkCode,
 c10 as fiscalYear,
 'o' + cast(id as varchar) as slink,
 isnull((select max(isnull(dateCleared,'')) from gldetail where slink='o' + cast(object.id as varchar) ),0) as dateCleared
from object where typ = 4771