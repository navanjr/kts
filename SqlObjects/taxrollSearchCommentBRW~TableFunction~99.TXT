create function dbo.taxrollSearchCommentBRW(
 @selectedId int
) returns @rt table(
 Id int,
 noteDate nvarchar(12),
 actionDate nvarchar(12),
 comment text
)
begin

 declare
  @name varchar(50),
  @item numeric (7,1),
  @parcel varchar(50),
  @taxYear numeric (5,0),
  @taxrollId int

 select 
  @name = name,
  @item = item,
  @parcel = parcel,
  @taxYear = taxyear,
  @taxrollId = taxrollId
 from invoices where id = @selectedId
 
  insert @rt
  select id,a2,a3,e1
  from dbo.object
  where typ=4002 and (key2=@name or len(key2)<1) and (key1=@parcel or len(key1)<1) and (case when isnumeric(key3)=1 then cast(key3 as numeric (7,1)) else 0 end=@item or len(key3)<2) and (case when isnumeric(a1)=1 then cast(a1 as numeric (5,0)) else 0 end =@taxyear or len(a1)<2)

  insert @rt
  select id,key2,'','Corrected: '+key3+': Original Value:'+case when a3 = '@d2;' then dbo.date1(a1) else rtrim(ltrim(a1)) end+'  New Value:'+case when a3 = '@d2;' then dbo.date1(a2) else rtrim(ltrim(a2)) end
  from dbo.object
  where typ=4005 and link1=@taxrollId


 return
end








