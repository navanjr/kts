create procedure dbo.taxrollAddCommentBatch(@commentId int, @taxInquiryId int)
as
begin
 declare @invoiceId int
 
 select @invoiceId = type1 from object where id = @commentId

 if isnull(@commentId,0)=0
 begin
  select '@code=1;@message=No Comment Record Selected...;'
  return
 end

 if isnull(@taxInquiryId,0)=0
 begin
  select '@code=1;@message=No Tax Inquiry Screen Indicated...;'
  return
 end

 if not exists(select 4002,i.item,i.parcel,i.name,i.taxyear,c.a2,c.a3,c.a4,c.a7,c.e1,i.id
  from object c, receiptlink r, invoices i
  where c.id = @commentId 
   and r.receiptid = @taxInquiryId
   and r.invoiceid <> @invoiceId
   and r.invoiceid = i.id)
 begin
  select '@code=1;@message=No records to copy identified...;'
  return
 end

 else 

 begin
  insert object (typ,key1,key2,key3,a1,a2,a3,a4,a7,e1,type1)
   select 4002,i.item,i.parcel,i.name,i.taxyear,c.a2,c.a3,c.a4,c.a7,c.e1,i.id
    from object c, receiptlink r, invoices i
    where c.id = @commentId 
     and r.receiptid = @taxInquiryId
     and r.invoiceid <> @invoiceId
     and r.invoiceid = i.id

  select '@code=0;@message=Comments copied...;'
 end

end