create procedure dbo.diagnostics(
 @method varchar(50) = 'all',
 @verbose varchar(5) = 'TRUE'
) as 
begin

 declare @results table(
  id int identity(1,1),
  method varchar(50),
  code int,
  message varchar(max),
  tally int,
  fixProc varchar(100)
 )

 declare 
  @methodUnit varchar(50),
  @code int = 0,
  @message varchar(max) = '',
  @tally int = 0
 
-- receiptLinks
 set @methodUnit = 'receiptLinks'
 if @method in ('all', @methodUnit)
 begin

  -- get your stats
  select 
   @code = case when count(*) > 0 then 1 else 0 end,
   @tally = COUNT(*),  
   @message = 'Tax receipts with out receiptLinks'
  from Object
  where typ = 4502 and key3 = 'TAX' and A17 = 'Posted'
   and ID not in (select receiptId from receiptlink)

  -- insert into results
  insert @results
   select @methodUnit, @code, @message, @tally ,'none' 
 
  exec dbo.logit @@procId, '@method', @methodUnit, '@code', @code, '@message', @message, '@tally', @tally   
 end

-- posted receipts with wrong status
 set @methodUnit = 'receiptWrongStatus'
 if @method in ('all', @methodUnit)
 begin

  select
   @code = case when count(*) > 0 then 1 else 0 end,
   @tally = count(*),
   @message = 'posted receipts with wrong status'
  from object where typ = 4502 and a17 != 'Posted' and 'o' + cast(id as varchar) in (select slink from gldetail)

  insert @results
   select @methodUnit, @code, @message, @tally, 'exec dbo.diagFix_receiptWrongStatus'  

  exec dbo.logit @@procId, '@method', @methodUnit, '@code', @code, '@message', @message, '@tally', @tally   
 end

-- Next unit test here





 
  if @verbose = 'TRUE'
   select method, tally, message, fixProc from @results where code = 1 order by id
  return

end