create procedure dbo.glDeleteSource (@sourceId int) as
begin

 if exists(select * from object where id = @sourceId and typ > 0)
 begin
  begin transaction
   delete glDetailStage where sourceId = @sourceId
   update object set typ = abs(typ) * -1 where id = @sourceId
  commit transaction
 end

end


