create function dbo.taxYearInvoiced(@taxYear varchar(4),@switch varchar(1)) returns int
as begin

declare @x int
declare @wt table(id int)

 if @switch='I'
  begin  
    insert into @wt
       select  i.id from invoices i, gldetail g where i.TAXYEAR=@taxYear and i.invoiceid=0 and 't'+cast(i.ID as varchar)=slink 
  end

 if @switch='P'
  begin  
    insert into @wt
       select  i.id from invoices i, gldetail g where i.TAXYEAR=@taxYear and i.invoiceid=0 and printed>'  0' and 't'+cast(i.ID as varchar)=slink 
  end


  select @x = COUNT(distinct id) from @wt

 return @x

end