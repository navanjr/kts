create function dbo.rpTrustReportDetail(@begindate varchar(20),@enddate varchar(20))

returns  @rt table(AccountCode varchar(60),
AccountDesc varchar(60),
sourcedate varchar(50),
Number varchar(60),
BeginBalance money,
Deposits money,
JournalIn money,
CancelVoid money,
Vouchers money,
JournalOut money,
EndBalance money
)
as
begin

declare  @wt table(AccountCode varchar(60),
AccountDesc varchar(60),
sourcedate varchar(50),
Number varchar(60),
BeginBalance money,
Deposits money,
JournalIn money,
CancelVoid money,
Vouchers money,
JournalOut money,
EndBalance money
)


insert @wt (accountcode,accountdesc, beginbalance)
select accountCode,accountdesc,sum(amount) 
from dbo.gldetailreports 
where sourceDate<@begindate 
 and accounttype='PURPOSE'
group by accountCode,accountdesc

insert @wt (accountcode,accountdesc,sourcedate, endbalance)
select accountCode,accountdesc,'999999',sum(amount) 
from dbo.gldetailreports 
where sourceDate<=@enddate 
 and accounttype='PURPOSE'
group by accountCode,accountdesc

insert @wt (accountcode,accountdesc,sourcedate,number,deposits)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4502','4522')
group by accountCode,accountdesc,sourcedate,sourcekey1
     
insert @wt (accountcode,accountdesc,sourcedate,number,JournalIn)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType not in ('4502','4522','4771')
     and amount > 0
group by accountCode,accountdesc,sourcedate,sourcekey1
     
insert @wt (accountcode,accountdesc,sourcedate,number,JournalOut)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)*-1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType not in ('4502','4522','4771')
     and amount < 0
group by accountCode,accountdesc,sourcedate,sourcekey1
     
insert @wt (accountcode,accountdesc,sourcedate,number,cancelvoid)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4771')
     and amount > 0
group by accountCode,accountdesc,sourcedate,sourcekey1
     
insert @wt (accountcode,accountdesc,sourcedate,number,vouchers)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)*-1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4771')
     and amount < 0
group by accountCode,accountdesc,sourcedate,sourcekey1
     
insert @rt 
 select accountcode,accountdesc,
 sourcedate,
 number,
 sum(isnull(BeginBalance,0.00)),
 sum(isnull(Deposits,0.00)),
 sum(isnull(JournalIn,0.00)),
 sum(isnull(CancelVoid,0.00)),
 sum(isnull(Vouchers,0.00)),
 sum(isnull(JournalOut,0.00)),
 sum(isnull(EndBalance,0.00))
from @wt
group by accountCode,accountdesc,sourcedate,number

return
end