create function dbo.rpTrustReportDetail(@begindate varchar(20),@enddate varchar(20))

-- increased comment from 200 to 500 b/c of truncation errors

returns  @rt table(AccountCode varchar(60),
AccountDesc varchar(60),
sourcedate varchar(50),
Number varchar(60),
BeginBalance money,
Deposits money,
JournalIn money,
CancelVoid money,
Vouchers money,
JournalOut money,
EndBalance money,
Comment varchar(500)
)
as
begin

declare  @wt table(AccountCode varchar(60),
AccountDesc varchar(60),
sourcedate varchar(50),
Number varchar(60),
BeginBalance money,
Deposits money,
JournalIn money,
CancelVoid money,
Vouchers money,
JournalOut money,
EndBalance money,
comment varchar(500)
)


insert @wt (accountcode,accountdesc, beginbalance, number)
select accountCode,accountdesc,sum(amount), 'Begin Balance' 
from dbo.gldetailreports 
where sourceDate<@begindate 
 and accounttype='PURPOSE'
group by accountCode,accountdesc

insert @wt (accountcode,accountdesc,sourcedate, endbalance, number)
select accountCode,accountdesc,'999999',sum(amount), 'End Balance' 
from dbo.gldetailreports 
where sourceDate<=@enddate 
 and accounttype='PURPOSE'
group by accountCode,accountdesc

insert @wt (accountcode,accountdesc,sourcedate,number,deposits, comment)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount), rtrim(sourcea1)+' - '+sourced1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4502','4522')
group by accountCode,accountdesc,sourcedate,sourcekey1, rtrim(sourcea1)+' - '+sourced1
     
insert @wt (accountcode,accountdesc,sourcedate,number,JournalIn, comment)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount), sourcee1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType not in ('4502','4522','4771')
     and amount > 0
group by accountCode,accountdesc,sourcedate,sourcekey1, sourcee1
     
insert @wt (accountcode,accountdesc,sourcedate,number,JournalOut,comment)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)*-1,sourcee1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType not in ('4502','4522','4771')
     and amount < 0
group by accountCode,accountdesc,sourcedate,sourcekey1,sourcee1
     
insert @wt (accountcode,accountdesc,sourcedate,number,cancelvoid,comment)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount),sourcee1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4771')
     and amount > 0
group by accountCode,accountdesc,sourcedate,sourcekey1,sourcee1
     
insert @wt (accountcode,accountdesc,sourcedate,number,vouchers,comment)
select accountcode,accountdesc,sourcedate,sourcekey1,sum(amount)*-1,sourcee1
   from dbo.gldetailreports g
   where sourceDate>=@begindate 
     and sourceDate<=@enddate
     and accountType = 'PURPOSE'
     and sourceType in ('4771')
     and amount < 0
group by accountCode,accountdesc,sourcedate,sourcekey1,sourcee1
     
insert @rt 
 select accountcode,accountdesc,
 sourcedate,
 number,
 sum(isnull(BeginBalance,0.00)),
 sum(isnull(Deposits,0.00)),
 sum(isnull(JournalIn,0.00)),
 sum(isnull(CancelVoid,0.00)),
 sum(isnull(Vouchers,0.00)),
 sum(isnull(JournalOut,0.00)),
 sum(isnull(EndBalance,0.00)),
 comment
from @wt
group by accountCode,accountdesc,sourcedate,number,comment

return
end