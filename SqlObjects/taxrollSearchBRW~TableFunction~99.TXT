create function dbo.taxrollSearchBRW(
 @receiptId int,
 @selectedId int
) returns @rt table(
 invoiceId int,
 display varchar(250),
 name nvarchar(40),
 parcel nvarchar(40),
 taxYear numeric(5,0),
 item numeric(7,1),
 taxType nvarchar(1),
 amount money,
 due money,
 slink varchar(15),
 selectedFlag char(1),
 colorFlag int,
 ord varchar(100),
 origin varchar(50)
)
begin

 insert @rt
 select
  id*-1,
  '   ' + case
   when r.origin = 'Parcel' then name
   when r.origin = 'Resale' then name
   when r.origin = 'Name' then parcel
   else rtrim(name) + dbo.joinStr(' - ',parcel)
  end,
  name,
  parcel,
  taxYear,
  item,
  typ,
  invoiceAmount,
  invoiceDue,
  't' + cast(id as varchar),
  '',
  1,
  r.origin + 'b'+cast(taxYear as varchar)+parcel,
  r.origin
 from dbo.invoices
 join dbo.invoiceRelated(@selectedId) r on id = r.invoiceId
 where isnull(invoices.invoiceid,0)=0

 delete from @rt where isnull(due,0) < 0.01 and colorFlag != 0

 insert @rt(
  invoiceId,
  display,
  colorFlag,
  ord
 )
 select
  0,
  'Matched By ' + origin + case
   when origin = 'Parcel' then ': ' + min(parcel)
   when origin = 'Name' then ': ' + min(name)
   else ''
  end,
  0,
  origin + 'a' + cast(min(taxyear) as varchar) + min(parcel)
 from @rt
 where colorFlag = 1
 group by origin
  
 return
end