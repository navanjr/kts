create function dbo.posTF() returns @rt table(
 id int,
 receiptType varchar(50),
 paycode varchar(50),
 accountCode varchar(50),
 depositDate int,
 amount money,
 accountId int,
 postDate int,
 objTyp int
) as 
begin

 insert @rt
 select 
  0,
  a.receiptType,
  a.paycode,
  a.accountCode,
  case when o.key2 is null then dbo.clarionDate(getDate()) else o.key2 end,
  b.amount,
  x.accountId,
  a.postDate,
  o.typ
 from dbo.posAccounts(null) a
 left outer join gldetail b with (NOLOCK) on a.accountCode = b.accountCode
 left outer join object o with (NOLOCK) on dbo.slinkId(b.slink) = o.id
 left outer join paid p with (NOLOCK) on dbo.slinkId(b.slink2) = p.id
 left outer join dbo.glAccounts x on a.accountCode = x.accountCode
 where 1=1
--  isnull(p.depositId,0) = 0 -- this where clause will remove the receipts from your pos when they are linked to a deposit
--  and isnull(o.typ,0) not in (4513,4512)  
 return
end