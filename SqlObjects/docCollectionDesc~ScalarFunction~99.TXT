create function dbo.docCollectionDesc(@invoiceid int,@interestDate varchar(50),@options int)
returns varchar(max)

as
begin
 declare 
  @Ret varchar(max) = '',
  @legal varchar(max),
  @parcel varchar(50),
  @item varchar(30),
  @name varchar(50),
  @newestName varchar(50) = null,
  @settingNewestname varchar(10) = dbo.settingsF('site.delinquentTaxPublicationNameNewest','FALSE'),
  @adtaxId int,
  @taxyear int


 select 
  @adTaxId = taxrollId,
  @taxyear = taxyear,
  @name = name,
  @item = item,
  @parcel = parcel,
  @legal = dbo.getLegaldescription(id)
 from invoices where ID = @invoiceId

if @settingNewestname = 'TRUE'
  begin
   select top 1 @newestName = nullif(name,'') from taxrollDetail where adtaxId > 0  and dtype='aa' and taxYear = @taxYear and itemNumber = @item and charindex('import',stamp)>0 order by id desc
  select @name = coalesce(nullif(@newestName,''),@name)
  end
  

--LeftColumn
declare  @leftSplit table 
	(RowNumber int identity(1,1),
	LineOfText varchar(1000),
	LengthOfText int)

	insert @leftSplit
	select @name,LEN(@name)
	
	insert @leftSplit
	select @parcel,LEN(@parcel)


	insert @leftSplit
    select rowdata,LengthOfText from dbo.splitL(@legal,26)
    
 --RightColumn   
  declare  @rightSplit table 
	(RowNumber int identity(1,1),
	LineOfText varchar(1000),
	LengthOfText int)
	
	insert @rightSplit
	select data,LEN(data) from dbo.split(dbo.docUnpaidSF(@invoiceId,@interestDate,@options) ,CHAR(13)+char(10)) where data>'  0'

declare @wt table (rowNumber int,
		rowStringLeft varchar(1000),
		rowStringRight varchar(1000))
			

	insert @wt
	select RowNumber,LineOfText,'' from @leftSplit

	insert @wt
	select RowNumber,'',LineOfText from @rightSplit
 
    
	select 
	@ret = @ret + dbo.padright(case when rowNumber!=1 then '      '  else '' end + MAX(rowStringLeft),' ',34)
	+ case when rowNumber!=1 then '  '  else '' end + MAX(rowStringRight)
	+ CHAR(13) + CHAR(10)
	from @wt 
	group by rowNumber
	
return @ret

end
