create procedure dbo.keySQLObjectWriteToRepo( @id int )
as
begin
 set nocount on
 
 declare
  @gitCommitter varchar(10),
  @txt varchar(max),
  @path varchar(100),
  @objectName varchar(60),
  @objectType varchar(50),
  @objectOrder varchar(50),
  @fullPath varchar(1000),
  @idToken int,
  @tally int

 select @gitCommitter = dbo.readString('@gitCommitter=', b14) from object where typ = 0 and link1 = -1

-- bail if we are not a git committer
 if not isnull(@gitCommitter,'FALSE') = 'TRUE'
 begin
  exec dbo.logit @@procid, 'not a git Committer'
  return
 end

 select @path = dbo.settingsF('git.gitpath','')

 declare @wt table(
  objectId int,
  objectName varchar(60),
  objectType varchar(50),
  objectOrder varchar(50),
  fullPath varchar(1000),
  data varchar(max),
  processFlag int
 )

 if isnull(@id,0) = 0
  insert @wt
  select
   id,
   rtrim(key1),
   rtrim(key2),
   rtrim(a17),
   '',
   cast(e1 as varchar(max)),
   0
  from Object where typ = 451 and key1 > '  0' and key2 > '  0' and a17 > '  0'
 else
  insert @wt
  select
   id,
   rtrim(key1),
   rtrim(key2),
   rtrim(a17),
   '',
   cast(e1 as varchar(max)),
   0
  from Object where typ = 451 and id = @id and key1 > '  0' and key2 > '  0' and a17 > '  0'

  update @wt set fullPath =  @path + '\SqlObjects\' + objectName + '~' + objectType + '~' + objectOrder + '.TXT'  

-- bail if we are not ready
 if not exists(select * from @wt)
 begin
  exec dbo.logit @@procid, 'nothing ready to write to Repo...'
  return
 end

 select @tally = count(*) from @wt
 if @tally > 1
  exec dbo.logit @@procid, 'Processing SqlObjects... @tally', @tally

 while exists(select * from @wt where processFlag = 0)
 begin
  select top 1
   @idToken = objectId,
   @objectName = objectName,
   @objectType = objectType,
   @objectOrder = objectOrder,
   @fullPath = fullPath,
   @txt = data
  from @wt where processFlag = 0
  order by objectOrder, objectName
 
  exec dbo.spOverwriteTextFile @fileName = @fullPath, @text = @txt

  update @wt set processFlag = 1 where objectId = @idToken
 end

end