create function dbo.receiptDetailBRW(@receiptId int, @showGL int) returns 
@rettable table(
 ord varchar(50),
 id int,
 description varchar(50), 
 subdescription varchar(50), 
 amount money 
)
begin

 insert @rettable
 select 'aa',cast('9'+cast(id as varchar) as int)*-1,description,subDescription,amount from receiptDetail where receiptId = @receiptId

 if exists(select * from dbo.paid where sourceId = @receiptId)
 begin
  insert @rettable
  select 'ba',0,'','',0
  insert @rettable
  select 'bb',0,'Payment(s)','',0
  insert @rettable
  select 'bc',cast('8'+cast(id as varchar) as int)*-1,'   '+paycode,checkno,amount*-1 from dbo.paid where sourceId = @receiptId
 end

 if @showGl = 1
 begin
  if exists(select * from dbo.glDetailStage where sourceId = @receiptId)
  begin
   insert @rettable
   select 'ca',0,'','',0
   insert @rettable
   select 'cb',0,'GL Detail (staged)','',0
   insert @rettable
   select 'cc',0,'   '+accountDesc,'',amount from dbo.glDetailStage where sourceId = @receiptId
  end

  if exists(select * from dbo.glDetail where sourceId = @receiptId)
  begin
   insert @rettable
   select 'ca',0,'','',0
   insert @rettable
   select 'cb',0,'GL Detail (posted)','',0
   insert @rettable
   select 'cc',0,'   '+accountDesc,'',amount from dbo.glDetail where sourceId = @receiptId
  end
 end

 return
end





