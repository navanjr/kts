create function dbo.docBRWDecoder( 
 @brwId int
) returns @rt table(
 documentName varchar(50),
 documentDate int,
 documentId int,
 reportName  varchar(50),
 processCode varchar(50)
) as
begin

 declare
  @retval varchar(max),
  @idSwitch int,
  @batchId int,
  @processCode varchar(50),
  @documentName varchar(50)
 
 select
  @idSwitch = left( cast(@brwId as varchar), 1),
  @batchId = substring( cast(@brwId as varchar), 2, 20)

  if @idSwitch = 9
   insert @rt
   select
    documentName,
    documentDate,
    null,null,
    processCode
   from documentProcessing where id = @batchId 

  if @idSwitch = 8
   insert @rt
   select
    documentName,
    dbo.clarionDate(documentDateTime),
    null,null,
    stamp
   from taxrollDetail where id = @batchId

 update a set
  a.documentId = b.id,
  a.reportName = b.key3
 from @rt a, object b
 where b.typ = 4900 
  and a.documentName = b.key1
 
 return

end