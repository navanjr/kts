create view warrants

as

select 
w.key1 as RegNo,
w.key2 as RegDateNo,
dbo.date1(w.key2) as RegDate,
w.key3 as WarNo,
w.a1 as WarDateNo,
dbo.date1(w.a1) as WarDate,
w.a2 as Payee,
case when isnumeric(w.a3)=1 then cast(w.a3 as money) else 0.00 end as amount,
f.accountCode as FundCode,
f.accountDesc as FundDesc,
tc.key1 as PayNo,
tc.key2 as PayDateNo,
dbo.date1(tc.key2) as PayDate,
case when isnumeric(tc.a3)=1 then cast(tc.a3 as money) else 0.00 end as PayAmount,
w.c10 as fiscalYear,
w.a4 as debitCode
from object w, glaccounts l, glaccounts f, object tc 
where 
w.typ=4771 
and tc.typ=4771
and w.link1 = tc.id
and w.a4 = l.accountCode
and l.targetaccountCode = f.accountCode
and w.a18='Warrant'
and tc.a18 = 'Treasurers Check'

union all

select 
w.key1 as RegNo,
w.key2 as RegDateNo,
dbo.date1(w.key2) as RegDate,
w.key3 as WarNo,
w.a1 as WarDateNo,
dbo.date1(w.a1) as WarDate,
w.a2 as Payee,
case when isnumeric(w.a3)=1 then cast(w.a3 as money) else 0.00 end as amount,
f.accountCode as FundCode,
f.accountDesc as FundDesc,
'' as PayNo,
'' as PayDateNo,
'' as PayDate,
0.00 as PayAmount,
w.c10 as fiscalYear,
w.a4 as debitCode
from object w, glaccounts l, glaccounts f 
where 
w.typ=4771 
and a4 = l.accountCode
and l.targetaccountCode = f.accountCode
and w.a18='Warrant'
and w.link1 not in (select id from object where typ=4771 and a18='Treasurers Check')