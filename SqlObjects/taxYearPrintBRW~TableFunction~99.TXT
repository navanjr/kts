create function dbo.taxYearPrintBRW( @taxYear varchar(50) ) returns @rt table(
 brwid int identity(-1,-1),
 ord varchar(50),
 code varchar(50),
 theRealMortCode varchar(50),
 tally  varchar(50),
 tallyPrinted varchar(50),
 amount varchar(50),
 blob varchar(max)
) as 
begin

 declare @tally int

-- invoices processing
 if exists(select * from taxrollInvoiceProcessing where taxyear = @taxyear)
 begin
  insert @rt (ord,code,tally,amount) select '9a', '--Invoice Batches--','Count','Amount'
  insert @rt (ord,code,tally,blob)
   select '9b', '   ' + processCode, count(*), '@mode=invoice;@code=' + processCode + ';' from taxrollInvoiceProcessing where taxyear = @taxyear group by processCode
  insert @rt (ord) select '9c'
 end

-- un-invoiced
 if exists(select * from adtax where realtaxyear = @taxyear and id not in (select taxrollid from invoices))
 begin
  insert @rt (ord,code,tally,amount) select 'a0 ','Un-Invoiced','Count','Amount'
  insert @rt 
   select 'a1'+recordType+pertyp,'   Type: ' + recordType+','+pertyp,'',count(*),0,sum(balanceDue), '' from adtax where realtaxyear = @taxyear and id not in (select taxrollid from invoices) 
   group by recordType,pertyp

  insert @rt 
   select 'a2','      Total','',count(*),0,sum(balanceDue), '' from adtax where realtaxyear = @taxyear and id not in (select taxrollid from invoices)
 end

-- all invoices
 insert @rt (ord,code) select 'aa1 ',''
 insert @rt 
   select 'aa2','Total Invoiced','',count(*),sum(case when printed > '  0' then 1 else 0 end),sum(invoiceDue), '' from invoices where taxyear = @taxyear

 -- Zero Balance Issue
 select @tally = count(*) from invoices where taxyear = @taxyear and invoiceDue = 0 and status<>'Exempt'
 if @tally > 0
  insert @rt (ord,code,tally,blob) 
    select 'ab','   Zero Balance Issue', @tally,'@mode=pass;@code=exec dbo.invoiceUpdate @taxyear=' + @taxyear + ';'

 -- no GL Detail Issue
 select @tally = count(*) from invoices where 't'+cast(id as varchar) not in (select slink from gldetail)
 if @tally > 0
   insert @rt (ord,code,tally,blob)
   select 'ac','   Invoice(s) without glDetail', @tally,'@mode=pass;@code=exec dbo.invoiceCRUD @mode=3, @taxyear=' + @taxyear + ', @noGLDetailIssue=''TRUE'';'

-- Exempt Invoices
   insert @rt (ord,code,tally)
   select 'ac1','   Exempt Invoices',count(id) from invoices where status='Exempt'

/*
-- print Ready

-- Batches
 insert @rt (ord) select 'ad'
 insert @rt (ord,code,tally,amount) select 'ad1', '--Printing--','Count','To Print'

 insert @rt 
  select 'ad3','Ready to Print','',count(I.id),sum(case when I.printed > '  0' then 1 else 0 end),sum(case when isnull(I.printed,'') in ('Failed','') then 1 else 0 end), '@mode=batch;@scope=all;'    
    from invoices i, adtax x 
    where i.taxrollid = x.id
     and case when x.treamort > '  0' then x.treamort else cast(x.mortgageCode as varchar) end <= '0'
     and i.taxyear = @taxyear
     and i.invoiceId = 0
     and i.typ not in ('O')
     and i.invoiceDue != 0


-- mortgage codes
 insert @rt (ord) select 'ba'
 insert @rt (ord,code,tally,amount) select 'bb', '--Mortgage Codes--','Count','To Print'

 insert @rt 
 select
  'bb2', '   ' + mortgageCode,max(theRealMortCode),count(*),sum(case when printed < '  0' then 1 else 0 end),0, '@mode=batch;@scope=mortgage;@code=' + theRealMortCode + ';'
 from taxYearPrintMortCodeView
 where taxyear = @taxyear
 group by mortgageCode,brwid,theRealMortCode

 insert @rt (ord) select 'bb3'

 insert @rt 
 select
   'bb3a', 'Mortgage Code Totals ','',count(*),sum(case when printed < '  0' then 1 else 0 end),0,''
 from taxYearPrintMortCodeView
 where taxyear = @taxyear



-- Batches
 insert @rt (ord) select 'ca'
 insert @rt (ord,code,tally,amount) select 'cb', '--Print Batches--','Count','To Print'

--Insert failed 

 insert @rt (ord,code,tally,tallyPrinted,amount,blob)
 select
  'cc', '   ' + queue, count(*),
  sum(case when isnull(printed,'') in ('Failed','') then 1 else 0 end),sum(case when isnull(printed,'') in ('Failed','') then 1 else 0 end),
  '@mode=queue;@code=' + queue + ';@unPrinted=' + cast(sum(case when isnull(printed,'') in ('Failed','') then 1 else 0 end) as varchar) + ';'
 from invoices where queue > '  0' and taxyear = @taxYear group by queue

 insert @rt (ord) select 'cd'

 insert @rt (ord,code,tally,tallyPrinted,amount)
 select
  'ce', 'Print Batch Totals', count(*), sum(case when isnull(printed,'') in ('Failed','') then 0 else 1 end),sum(case when isnull(printed,'') in ('Failed','') then 1 else 0 end)
 from invoices where queue > '  0' and taxyear = @taxYear
*/
 return
end