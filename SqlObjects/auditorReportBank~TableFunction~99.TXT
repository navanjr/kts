create function dbo.auditorReportBank(@begindate varchar(15),@enddate varchar(15))
returns @rt table(
accountDesc varchar(60),
accountCode varchar(60),
bankAccount varchar(60),
DemandBalance money,
InvestBalance money,
TotalCash money,
Collateral money,
FDIC money
)
as begin

declare @dailyledgerdetail table(
 accountCode varchar(50),
 accountDesc varchar(50),
 beginbalance money,
 paid money,
 appout money,
 appin money,
 tranout money,
 tranin money,
 deposits money,
 endbalance money,
 accountType varchar(50),
 reportOrder varchar(50)
)

insert @dailyledgerdetail
select * from dailyledgerdata(@beginDate,@endDate) 

insert @rt
select d.accountDesc,
       d.accountCode,
       a.bankAccount,
       case when a.accountType='BANK' then endBalance else 0.00 end as DemandBalance,
       case when a.accountType='INVESTMENT' then endBalance else 0.00 end as InvestBalance,
       endBalance as TotalCash,
       isnull((select top 1 cast(c6 as money) from object where key1=a.accountCode and a2<=@endDate order by a2 desc),0) as Collateral,
       isnull((select top 1 cast(c7 as money) from object where key1=a.accountCode and a2<=@endDate order by a2 desc),0) as FDIC
  from @dailyledgerdetail d, glaccounts a 
where d.accountType='BANK'
 and d.accountCode=a.accountCode
order by d.accountType,d.reportOrder



return
end