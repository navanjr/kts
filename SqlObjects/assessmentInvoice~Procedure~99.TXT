CREATE procedure [dbo].[assessmentInvoice](@assessmentId int)
as

begin

 declare 
  @slink varchar(15),
  @invoiceId int 


--  begin transaction
  exec dbo.assessReferenceCRUD @assessmentId
  select top 1 @invoiceId = id from invoices where typ='S' order by id desc
  
  exec dbo.taxrollInvoiceCRUD @assessmentId, 0, 'S', @invoiceId=@invoiceId
  exec dbo.taxRollAddressInsert @assessmentId, 'S'  
  
  select @slink = slink from dbo.taxrollCheck(@assessmentId,'S',null)

  if dbo.glPostCheck(@slink) = 0
   begin
    select '@code=0;@message=OK;'
   end
  else
   begin 
    select '@code=1;@message=Assessment failed to process correctly, Contact Support. (as.inv);'
   end


end