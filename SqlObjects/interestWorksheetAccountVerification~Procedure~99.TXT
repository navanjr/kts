create procedure dbo.interestWorksheetAccountVerification(@date varchar(20),@overWrite varchar(10),@split varchar(10))
as
begin
 declare @nameToken varchar(60)

 declare @wt table(name varchar(60),
                  fund varchar(60),
                  formulaAmount money,
                  schPagesCat varchar(50),
                  tableType varchar(50),
                  yearMonth varchar(10)
                  )
                  
 insert @wt
 select left(rtrim(apyear)+right('00'+rtrim(apmonth),2)+' '+TableType,50) as Name,accountCode as fund,amount as formulaAmount,comment2 as schpagescat,
   'Interest '+left(tableType,len(tableType)-len(bankdesc)) as TableType,rtrim(apyear)+right('00'+rtrim(apmonth),2) as yearmonth 
   from dbo.interestWorkSheetDetail(@date, @split)

 if @overWrite='TRUE' 
 begin
  update object set typ=-4022 where typ=4022 and key1 in (select name from @wt)
 end

 if not exists(select * from object where typ=4022 and key1 in (select name from @wt))
 begin
  insert object (typ,key1,key2,key3,a1,a17,a18,k2)
   select 4022,name,fund,formulaamount,schpagescat,tabletype,yearmonth,left(rtrim(name)+fund,30) from @wt
 end 

 while exists(select name from @wt)
 begin
  select top 1 @nameToken=name from @wt
   exec dbo.apportionTableFundReceivableVerification @nameToken
  delete from @wt where name=@nameToken
 end
end


