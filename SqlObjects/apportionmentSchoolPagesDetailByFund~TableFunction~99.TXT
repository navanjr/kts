create function dbo.apportionmentSchoolPagesDetailByFund(@beginDate int,@endDate int, @includeUnapportioned varchar(10)) returns @rt table(id int identity(1,1),
	[reportOrder] [varchar](60) NOT NULL default '',
	[accountCode] [varchar](60) NOT NULL default '',
	[accountDesc] [varchar](50) NOT NULL default '',
	[district] varchar(50) NOT NULL default '',
	[accountType] [varchar](50) NOT NULL default '',
	[comment2] [varchar](50) NOT NULL default '',
	[currentTax] [money] NOT NULL default 0,
	[priorTax] [money] NOT NULL default 0,
	[backTax] [money] NOT NULL default 0,
	[amount1] [money] NOT NULL default 0,
	[amount2] [money] NOT NULL default 0,
	[amount3] [money] NOT NULL default 0,
	[amount4] [money] NOT NULL default 0,
	[amount5] [money] NOT NULL default 0,
	[amount6] [money] NOT NULL default 0,
	[amount7] [money] NOT NULL default 0,
	[amount8] [money] NOT NULL default 0,
	[amount9] [money] NOT NULL default 0,
	[amount10] [money] NOT NULL default 0,
	[amount11] [money] NOT NULL default 0,
	[amount12] [money] NOT NULL default 0,
	[total] [money] NOT NULL default 0,
	[heading1] varchar(50) NOT NULL default '',
	[heading2] varchar(50) NOT NULL default '',
	[heading3] varchar(50) NOT NULL default '',
	[heading4] varchar(50)  NOT NULL default '',
	[heading5] varchar(50) NOT NULL default '',
	[heading6] varchar(50) NOT NULL default '',
	[heading7] varchar(50) NOT NULL default '',
	[heading8] varchar(50) NOT NULL default '',
	[heading9] varchar(50) NOT NULL default '',
	[heading10] varchar(50) NOT NULL default '',
	[heading11] varchar(50) NOT NULL default '',
	[heading12] varchar(50) NOT NULL default ''
)

as
begin

declare @det table(
    id int identity(1,1),
	[accountType] [varchar](50) NOT NULL default '',
	[accountId] [int] NOT NULL default 0,
	[accountCode] [varchar](60) NOT NULL default '',
	[accountDesc] [varchar](50) NOT NULL default '',
	[comment] [varchar](50) NOT NULL default '',
	[comment2] [varchar](50) NOT NULL default '',
	[sourceCode] [varchar](60) NOT NULL default '',
	[amount] [money] NOT NULL default 0,
	[journalType] [varchar](50) NOT NULL default '',
	[sourceDesc] [varchar](50) NOT NULL default '',
	[sourceSECA] [varchar](50) NOT NULL default '',
	[journalDesc] [varchar](50) NOT NULL default ''
)

insert @det
select isnull(accountType,''),
	isnull(accountId,0),
	isnull(accountCode,''),
	isnull(accountDesc,''),
	isnull(comment,''),
	isnull(comment2,''),
	isnull(sourceCode,''),
	isnull(amount,0),
	isnull(journalType,''),
	isnull(sourceDesc,''),
	isnull(sourceSECA,''),
	isnull(journalDesc,'') from rpMonthEndDetail(@beginDate,@endDate, @includeUnapportioned) 
 where isnull(sourceCode,'Not Found') in (select accountCode from glAccounts)
  and accountType in (select accountType from dbo.glBankFundTypes('FUND'))

update @det set comment2='4 MILL' where comment2 like '%MILL%' and comment2 not like '%JOINT%' 

update @det set accountType='COUNTY SCHOOL' where accountType='SCHOOL' 
and accountCode in (select accountCode from @det where comment2 like '%MILL%' and comment2 not like '%JOINT%' )

update @det set accountType='JOINT SCHOOL' where accountType='SCHOOL'

update @det set sourceCode = 'ADVALOREM', sourceDesc = 'ADVALOREM', sourceSECA = 'ADVALOREM' where journalDesc like '%ADVALOREM%'



declare @years table(id int identity(1,1),yearCode varchar(50),journalDesc varchar(50))

insert @years
select top 1 'Current',journalDesc from @det where sourceCode='ADVALOREM' order by journalDesc desc
insert @years
select top 1 'Prior',journalDesc from @det where sourceCode='ADVALOREM' and journalDesc not in (select journalDesc from @years) order by journalDesc desc
insert @years
select distinct 'Back',journalDesc from @det where sourceCode='ADVALOREM' and journalDesc not in (select journalDesc from @years)

declare @det2 table(id int identity(1,1),
	[accountCode] [varchar](60) NULL,
	[accountDesc] [varchar](50) NULL,
	[accountType] [varchar](50) NULL,
	[comment2] [varchar](50) NULL,
	[journalDesc] [varchar](50) NULL,
	[amount] [money] NOT NULL default 0
    )

insert @det2
select a.accountCode,a.accountDesc,a.accountType,a.comment2,b.yearCode, sum(amount)*-1 from @det a, @years b 
 where a.journalDesc=b.journalDesc and a.accountType<>'FUND'
group by a.accountType,a.accountCode,a.accountDesc,a.comment2,b.yearCode
order by a.accountType,a.accountCode,a.accountDesc,a.comment2,b.yearCode

insert @det2
select a.accountCode,a.accountDesc,a.accountType,'',b.yearCode, sum(amount)*-1 from @det a, @years b 
 where a.journalDesc=b.journalDesc and a.accountType='FUND'
group by a.accountType,a.accountCode,a.accountDesc,b.yearCode
order by a.accountType,a.accountCode,a.accountDesc,b.yearCode

delete from @det where journalDesc in (select journalDesc from @years)

update d set comment2 = case when monthEndCategory > ' 0' then monthEndCategory else 'GENERAL' end from @det d, glaccounts a where d.sourceCode=a.accountCode 

insert @rt (accountType,accountCode,accountDesc,comment2)
select distinct accountType,accountCode,accountDesc,comment2 from @det2 where accountType<>'FUND' order by  accountCode,accountDesc,comment2

insert @rt (accountType,accountCode,accountDesc)
select distinct accountType,accountCode,accountDesc from @det2 where accountType='FUND' order by  accountCode,accountDesc

update r set currentTax=b.amount from @rt r, @det2 b 
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and case when r.accountType <> 'FUND' then r.comment2 else b.comment2 end = b.comment2
     and b.journalDesc='Current'

update r set priorTax=b.amount from @rt r, @det2 b 
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and case when r.accountType <> 'FUND' then r.comment2 else b.comment2 end = b.comment2
     and b.journalDesc='Prior'

update r set backTax=b.amount from @rt r, @det2 b 
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and case when r.accountType <> 'FUND' then r.comment2 else b.comment2 end = b.comment2
     and b.journalDesc='Back'


delete from @det2 where accountCode > ' 0'

declare @schoolHeadings table(id int identity(1,1),heading varchar(50),processFlag int)
insert @schoolHeadings
select distinct sourceDesc,0 from @det where (accountType like '%SCHOOL%' or accountType='VOTECH') and amount <> 0.00

insert @det2
 select a.accountCode,a.accountDesc,a.accountType,a.comment2,sourceDesc, sum(amount)*-1 from @det a 
  where accountType like '%SCHOOL%' or accountType='VOTECH'
 group by a.accountType,a.accountCode,a.accountDesc,a.comment2,sourceDesc
order by a.accountType,a.accountCode,a.accountDesc,a.comment2,sourceDesc

delete from @det where accountType like '%SCHOOL%' or accountType='VOTECH'

insert @rt (accountType,accountCode,accountDesc,comment2)
select distinct accountType,accountCode,accountDesc,comment2 from @det2 d 
 where comment2 not in (select comment2 from @rt where accountType=d.accountType and accountCode=d.accountCode and accountDesc=d.accountDesc) 


update r set amount1=b.amount, heading1 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=1

update r set amount2=b.amount, heading2 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=2

update r set amount3=b.amount, heading3 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=3

update r set amount4=b.amount, heading4 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=4

update r set amount5=b.amount, heading5 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=5

update r set amount6=b.amount, heading6 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=6

update r set amount7=b.amount, heading7 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=7

update r set amount8=b.amount, heading8 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=8

update r set amount9=b.amount, heading9 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=9

update r set amount10=b.amount, heading10 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=10

update r set amount11=b.amount, heading11 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=11

update r set amount12=b.amount, heading12 = c.heading from @rt r, @det2 b, @schoolHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=12


insert @rt (reportOrder,accountType,comment2,currentTax,priorTax,backTax,amount1,amount2,amount3,amount4,amount5,amount6,amount7,amount8,amount9,amount10,amount11,amount12)
select '4500','SCHOOL TOTAL', comment2, sum(currentTax), sum(priorTax), sum(backTax), sum(amount1), sum(amount2), sum(amount3), sum(amount4), sum(amount5), sum(amount6), sum(amount7), sum(amount8), sum(amount9), sum(amount10), sum(amount11), sum(amount12) 
 from @rt where accountType like '%SCHOOL%' or accountType='VOTECH'
group by comment2



update r set heading1 = isnull((select max(heading1) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''), 
             heading2 = isnull((select max(heading2) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading3 = isnull((select max(heading3) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading4 = isnull((select max(heading4) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading5 = isnull((select max(heading5) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading6 = isnull((select max(heading6) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading7 = isnull((select max(heading7) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading8 = isnull((select max(heading8) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading9 = isnull((select max(heading9) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading10 = isnull((select max(heading10) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading11 = isnull((select max(heading11) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),''),
             heading12 = isnull((select max(heading12) from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'),'')
from @rt r where r.accountType like '%SCHOOL%' or r.accountType='VOTECH'


delete from @det2 where accountCode > ' 0'
delete from @schoolHeadings where id>0

declare @cityHeadings table(id int identity(1,1),heading varchar(50),processFlag int)
insert @cityHeadings
select distinct sourceDesc,0 from @det where accountType='CITY' and amount <> 0.00



insert @det2
 select a.accountCode,a.accountDesc,a.accountType,a.comment2,sourceDesc, sum(amount)*-1 from @det a 
  where accountType='CITY'
 group by a.accountType,a.accountCode,a.accountDesc,a.comment2,sourceDesc
order by a.accountType,a.accountCode,a.accountDesc,a.comment2,sourceDesc

delete from @det where accountType='CITY'

insert @rt (accountType,accountCode,accountDesc,comment2)
select distinct accountType,accountCode,accountDesc,comment2 from @det2 d 
 where comment2 not in (select comment2 from @rt where accountType=d.accountType and accountCode=d.accountCode and accountDesc=d.accountDesc) 


update r set amount1=b.amount, heading1 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=1

update r set amount2=b.amount, heading2 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=2

update r set amount3=b.amount, heading3 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=3

update r set amount4=b.amount, heading4 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=4

update r set amount5=b.amount, heading5 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=5

update r set amount6=b.amount, heading6 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=6

update r set amount7=b.amount, heading7 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=7

update r set amount8=b.amount, heading8 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=8

update r set amount9=b.amount, heading9 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=9

update r set amount10=b.amount, heading10 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=10

update r set amount11=b.amount, heading11 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=11

update r set amount12=b.amount, heading12 = c.heading from @rt r, @det2 b, @cityHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=12

update r set heading1 = isnull((select max(heading1) from @rt r where r.accountType='CITY'),''), 
             heading2 = isnull((select max(heading2) from @rt r where r.accountType='CITY'),''),
             heading3 = isnull((select max(heading3) from @rt r where r.accountType='CITY'),''),
             heading4 = isnull((select max(heading4) from @rt r where r.accountType='CITY'),''),
             heading5 = isnull((select max(heading5) from @rt r where r.accountType='CITY'),''),
             heading6 = isnull((select max(heading6) from @rt r where r.accountType='CITY'),''),
             heading7 = isnull((select max(heading7) from @rt r where r.accountType='CITY'),''),
             heading8 = isnull((select max(heading8) from @rt r where r.accountType='CITY'),''),
             heading9 = isnull((select max(heading9) from @rt r where r.accountType='CITY'),''),
             heading10 = isnull((select max(heading10) from @rt r where r.accountType='CITY'),''),
             heading11 = isnull((select max(heading11) from @rt r where r.accountType='CITY'),''),
             heading12 = isnull((select max(heading12) from @rt r where r.accountType='CITY'),'')
from @rt r where r.accountType='CITY'

delete from @det2 where accountCode > ' 0'

update @rt set comment2 = accountDesc, district='CNTY' where accountType = 'FUND'

insert @det2
 select a.accountCode,a.accountDesc,a.accountType,a.accountDesc,case when b.monthEndColumn >' 0' then b.monthEndColumn else 'OTHER' end, sum(amount)*-1 from @det a, glaccounts b 
  where a.sourceCode=b.accountCode and a.accountType='FUND'
 group by a.accountType,a.accountCode,a.accountDesc,a.comment2,case when b.monthEndColumn >' 0' then b.monthEndColumn else 'OTHER' end


declare @fundHeadings table(id int identity(1,1),heading varchar(50),processFlag int)

insert @fundHeadings
select distinct journalDesc,0 from @det2 where accountType='FUND' and amount <> 0.00

delete from @det where accountType='FUND'

insert @rt (accountType,accountCode,accountDesc,comment2,district)
select distinct accountType,accountCode,accountDesc,comment2,'FUND' from @det2 d 
 where comment2 not in (select comment2 from @rt where accountType=d.accountType and accountCode=d.accountCode and accountDesc=d.accountDesc) 


update r set amount1=b.amount, heading1 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=1

update r set amount2=b.amount, heading2 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=2

update r set amount3=b.amount, heading3 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=3

update r set amount4=b.amount, heading4 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=4

update r set amount5=b.amount, heading5 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=5

update r set amount6=b.amount, heading6 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=6

update r set amount7=b.amount, heading7 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=7

update r set amount8=b.amount, heading8 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=8

update r set amount9=b.amount, heading9 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=9

update r set amount10=b.amount, heading10 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=10

update r set amount11=b.amount, heading11 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=11

update r set amount12=b.amount, heading12 = c.heading from @rt r, @det2 b, @fundHeadings c
   where r.accountType=b.accountType 
     and r.accountCode=b.accountCode
     and r.accountDesc=b.accountDesc
     and r.comment2=b.comment2
     and b.journalDesc=c.heading
     and c.id=12

update r set heading1 = isnull((select max(heading1) from @rt r where r.accountType='FUND'),''), 
             heading2 = isnull((select max(heading2) from @rt r where r.accountType='FUND'),''),
             heading3 = isnull((select max(heading3) from @rt r where r.accountType='FUND'),''),
             heading4 = isnull((select max(heading4) from @rt r where r.accountType='FUND'),''),
             heading5 = isnull((select max(heading5) from @rt r where r.accountType='FUND'),''),
             heading6 = isnull((select max(heading6) from @rt r where r.accountType='FUND'),''),
             heading7 = isnull((select max(heading7) from @rt r where r.accountType='FUND'),''),
             heading8 = isnull((select max(heading8) from @rt r where r.accountType='FUND'),''),
             heading9 = isnull((select max(heading9) from @rt r where r.accountType='FUND'),''),
             heading10 = isnull((select max(heading10) from @rt r where r.accountType='FUND'),''),
             heading11 = isnull((select max(heading11) from @rt r where r.accountType='FUND'),''),
             heading12 = isnull((select max(heading12) from @rt r where r.accountType='FUND'),'')
from @rt r where r.accountType='FUND'




update @rt set district = left(rtrim(accountCode)+' '+rtrim(accountDesc),50) where accountType like '%SCHOOL%' or accountType = 'VOTECH'
update @rt set district = left(rtrim(accountDesc),50) where isnull(district,'') < ' 0'

update @rt set reportOrder = case when accountType = 'JOINT SCHOOL' then '1000'
                                  when accountType = 'COUNTY SCHOOL' then '2000'
                                  when accountType = 'VOTECH' then '3000'
                                  when accountType = 'CITY' then '4000' 
                                  when accountType = 'SCHOOL TOTAL' then '5000' 
                                  else '6000' end



update @rt set total=currentTax+priorTax+backTax+amount1+amount2+amount3+amount4+amount5+amount6+amount7+amount8+amount9+amount10+amount11+amount12

return
end