CREATE function dbo.dailydata(@theDate int, @days int, @filterString varchar(50)) returns 
@rt table (
 id int,
 ord varchar(250),
 rowstring varchar(250),
 glBalanceString varchar(50),
 rowstring1 varchar(250),
 sourceNo varchar(50),
 recordCnt varchar(50),
 sourceAmt varchar(50),
 brwBGColor int
)
begin
 declare @showDetail table(id int)
 insert @showDetail select 4522

 declare @rawData table(
  amount money,
  tname varchar(50),
  typ int,
  num varchar(50),
  slink varchar(15),
  ord char(1)
 )

 -- get the raw data from glDetail, this yields receipts, vouchers, deposits

-- Collections
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataCollections(@theDate, @days, 'F', @filterString)

-- Deposits & Disbursments
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataDeposits(@theDate, @days, 'G', @filterString)

-- Vouchers
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataPayments('Official Voucher','Official',@theDate, @days, 'H', @filterString)

-- Cancelled Vouchers
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataPayments('Cancel Voucher','Official',@theDate, @days, 'H', @filterString)

-- Journal
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataJournal(@theDate, @days, 'I', @filterString)

-- Warrants
 if substring(@filterString,2,1) = '1'
  insert @rt 
  select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataPayments('Treasurers Check|Paid Warrant','Fund',@theDate, @days, 'J', @filterString)
    
-- Miscellaneous
if substring(@filterString,2,1) = '1'
 insert @rt 
 select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataPayments('Miscellaneous|Miscellaneou','Fund',@theDate, @days, 'K', @filterString) order by ord

-- Suspense
if substring(@filterString,1,1) = '1'
begin

 insert @rt 
 select id*-1,ord,rowString,glBalanceString,rowString1,sourceNo,recordCnt,sourceAmt,brwBGColor from dbo.dailyDataSuspense(@theDate, @days, 'C',@filterString) order by ord

--Pending Deposits
 insert @rt (id,ord,rowstring,glBalanceString,rowstring1,sourceNo,recordCnt,sourceAmt)
 select 
  cast('7'+cast(b.id as varchar) as int) * -1, 
  'DC',
  '   ' + dbo.padRight(receiptType + '      '
   + case when MAX(depositId) > 0 then '(deposit #'+(select key1 from object where id=max(depositId))+' started)' else '' end,' ',48)
  + dbo.padLeft(convert(varchar,sum(amount),1),' ',16),
  '',
  '   ' + dbo.padRight(receiptType + '      ',' ',48),
  case when MAX(depositId) > 0 then '(deposit #'+(select key1 from object where id=max(depositId))+' started)' else '' end,
  '',
  dbo.padLeft(convert(varchar,sum(amount),1),' ',16)
 from dbo.depositPaidUnPosted() a, object b
 where a.receiptType = b.key1 and b.typ = 4503
 group by receiptType, b.id

 insert @rt (id,ord,rowstring,glBalanceString,rowstring1,sourceAmt) 
     select 0,'DD',dbo.padLeft('Total',' ',51) + dbo.padLeft(convert(varchar,sum(amount),1),' ',16),'',dbo.padLeft('Total',' ',50),dbo.padLeft(convert(varchar,sum(amount),1),' ',16)
     from dbo.depositPaidUnPosted()

 insert @rt (id,ord,rowstring,glBalanceString) select 0,'D ','',''
 insert @rt (id,ord,rowstring,glBalanceString,rowstring1,brwBGColor) select 0,'DA','  Un-Posted Deposits','','  Un-Posted Deposits', 1
 insert @rt (id,ord,rowstring,glBalanceString,rowstring1,sourceNo,recordCnt,sourceAmt) select 0,'DB',' ' + replicate('-',69),'',' ' + replicate('-',69),replicate('-',22),replicate('-',10),replicate('-',16)

end

 return

end