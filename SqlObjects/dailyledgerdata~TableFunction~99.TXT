create function dbo.dailyledgerdata(@date varchar(50)) returns @rt table(accountCode varchar(50), accountDesc varchar(50), beginbalance money, paid money, tranout money, tranin money, deposits money, endbalance money, accountType varchar(50))
as 
begin 
declare @wt table(accountCode varchar(50), accountDesc varchar(50), beginbalance money, paid money, tranout money, tranin money, deposits money, endbalance money, accountType varchar(50))

declare @wt2 table(accountCode varchar(50), accountDesc varchar(50), beginbalance money, paid money, tranout money, tranin money, deposits money, endbalance money, accountType varchar(50))

insert @wt (accountCode, accountDesc, beginbalance, accountType)
select accountCode, accountDesc,sum(amount) as amount, accountType from dbo.glDetailReports 
where sourceDate<@date 
and accountType in (select accountType from dbo.glBankFundTypes('BOTH'))
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, paid, accountType)
select accountCode, accountDesc,sum(amount) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('BOTH'))
and sourceType in ('4771') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, deposits, accountType)
select accountCode, accountDesc,sum(amount) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('BOTH'))
and sourceType in ('4502','4513','4522') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, tranout, accountType)
select accountCode, accountDesc,sum(cast(credit as money)) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('BANK'))
and sourceType not in ('4502','4513','4522','4771') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, tranin, accountType)
select accountCode, accountDesc,sum(cast(debit as money)) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('BANK'))
and sourceType not in ('4502','4513','4522','4771') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, tranin, accountType)
select accountCode, accountDesc,sum(cast(credit as money)) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('FUND'))
and sourceType not in ('4502','4513','4522','4771') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, tranout, accountType)
select accountCode, accountDesc,sum(cast(debit as money)) as amount, accountType from dbo.glDetailReports 
where sourceDate=@date 
and accountType in (select accountType from dbo.glBankFundTypes('FUND'))
and sourceType not in ('4502','4513','4522','4771') 
group by accountCode, accountDesc, accountType

insert @wt (accountCode, accountDesc, endbalance, accountType)
select accountCode, accountDesc,sum(amount) as amount, accountType from dbo.glDetailReports 
where sourceDate<=@date 
and accountType in (select accountType from dbo.glBankFundTypes('BOTH'))
group by accountCode, accountDesc, accountType


insert @wt2
select accountCode, accountDesc, sum(beginbalance), sum(paid), sum(tranout), sum(tranin), sum(deposits), sum(endbalance), accountType from @wt
 group by accountCode, accountDesc, accountType
 
update @wt2 set beginbalance=beginbalance*-1, deposits=deposits*-1, endbalance=endbalance*-1 where accountType in (select accountType from dbo.glBankFundTypes('FUND'))
update @wt2 set paid=paid*-1 where accountType in (select accountType from dbo.glBankFundTypes('BANK'))

insert @rt
 select * from @wt2 where accountType in ('BANK','FUND')

insert @rt
select accountType, accountType+'S', sum(beginbalance), sum(paid), sum(tranout), sum(tranin), sum(deposits), sum(endbalance), accountType from @wt2
 where accountType in (select accountType from dbo.glBankFundTypes('BOTH')) and accountType not in ('BANK','FUND')
 group by accountType

update @rt set accountDesc = 'PENDING DEPOSITS' where accountType = 'SUSPENSE'
update @rt set accountType='BANK' where accountType in (select accountType from dbo.glBankFundTypes('BANK'))
update @rt set accountType='FUND' where accountType in (select accountType from dbo.glBankFundTypes('FUND'))
return
end