create function dbo.miscReceiptDetail(@receiptId int) returns 
@rettable table(
 ord varchar(50),
 id int,
 description varchar(50), 
 subdescription varchar(50), 
 amount money 
)
begin

 insert @rettable
 select 'aa',id,key1,key2+'/'+key3,cast(a1 as money) from object where typ=4503 and link1 = @receiptId

 if exists(select * from dbo.paid where sourceId = @receiptId)
 begin
  insert @rettable
  select 'ba',0,'','',0
  insert @rettable
  select 'bb',0,'Payment(s)','',0
  insert @rettable
  select 'bc',id*-1,'   '+paycode,checkno,amount*-1 from dbo.paid where sourceId = @receiptId
 end

 if exists(select * from dbo.glDetailStage where sourceId = @receiptId)
 begin
  insert @rettable
  select 'ca',0,'','',0
  insert @rettable
  select 'cb',0,'GL Detail (staged)','',0
  insert @rettable
  select 'cc',0,'   '+accountDesc,'',amount from dbo.glDetailStage where sourceId = @receiptId
 end

 if exists(select * from dbo.glDetail where sourceId = @receiptId)
 begin
  insert @rettable
  select 'ca',0,'','',0
  insert @rettable
  select 'cb',0,'GL Detail (posted)','',0
  insert @rettable
  select 'cc',0,'   '+accountDesc,'',amount from dbo.glDetail where sourceId = @receiptId
 end

 return
end


