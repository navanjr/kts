create procedure dbo.officialDepositLinkTrust(
 @officialDepositId int = null,
 @mode varchar(50),
 @paidId int = 0,
 @postDate int = null
) as 
begin

 exec dbo.logit @@procid, '@officialDepositId', @officialDepositId, '@mode', @mode, '@paidId', @paidId, '@postDate', @postDate
  
 declare @slink varchar(16) = 'o'+cast(@officialDepositId as varchar(15))

 if @mode = 'LINK ALL' 
 begin
 
  if isnull(@postDate,0) > 0
   update paid set officialDepositId = @officialDepositId where id in 
    (select id from dbo.depositPaidAndPosted()
      where receiptType = 'TRUST'
       and isnull(depositId,0) = 0
       and isnull(officialDepositId,0) = 0
       and depositDate = @postDate)

  else
   update paid set officialDepositId = @officialDepositId where id in 
    (select id from dbo.depositPaidAndPosted()
      where receiptType = 'TRUST'
       and isnull(depositId,0) = 0
       and isnull(officialDepositId,0) = 0)

 end

 if @mode = 'LINK ONE' 
 begin 
  update paid set officialDepositId = @officialDepositId where isnull(depositId,0)=0 and officialDepositId=0 and id = @paidId
 end

 if @mode = 'UNLINK ONE' 
 begin 
  update paid set officialDepositId = 0 where isnull(depositId,0)=0 and officialDepositId = @officialDepositId and id = @paidId
 end

 exec dbo.officialDepositStageGL @officialDepositId 

end