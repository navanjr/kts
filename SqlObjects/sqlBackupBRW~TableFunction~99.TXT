create function dbo.sqlBackupBRW() returns @rt table(
  brwid int,
  display varchar(max),
  size bigint,
  sizeMb varchar(50),
  modifiedDate varchar(50),
  pathAndFileName varchar(max),
  fileName varchar(max),
  ord varchar(50)
) as 
begin

 declare
  @backupFolder varchar(max),
  @database varchar(50) = (select county from dbo.site),
  @backupJobName varchar(100) = (select county from dbo.site) + '_backupJob',
  @jobId binary(16),
  @nextDateTime datetime

 select @backupFolder = path From dbo.paths() where name = 'backupPath'

 if @jobId is not null
  select @nextDateTime = next_scheduled_run_date from msdb..sysjobactivity where job_id = @jobId

 insert @rt 
 select
  cast('9' + cast(id as varchar) as int),
  '  ' + fileName,
  fileSize,
  cast(dbo.formatCurr(round(fileSize / 1024.0 / 1024.0, 2)) as varchar) + ' mb',
  modifiedDate,
  pathAndFileName,
  fileName,
  null
 from dbo.dirFiles(@backupFolder,null)
 where fileName like @database + '_%' or fileName like db_name() + '_%'
 order by modifiedDate desc

 update @rt set ord = 'c_1' + cast(99999 - brwid as varchar)
 insert @rt (display, ord) select '', 'c_0'
 insert @rt (display, ord) select 'Backup Files', 'c_10'

-- insert @rt (display, ord) select '', 'a_0'

 insert @rt (display, ord) select '', 'b_'
 insert @rt (display, ord) select 'Backup Settings', 'b_0'
 insert @rt (brwid, display, ord)
   select '7'+cast(id*-1 as varchar),' -'+description+': '+dbo.splitF(display,':',2),'b_'+ord from dbo.settingsBRW('backup')


-- insert @rt (brwid, display, ord) select 81, 'Scheduled Backup', 'a_11'
-- insert @rt (brwid, display,modifiedDate, ord) select 81, '    status: ' + status, nextTime, 'a_11' + name
--  from scheduledTasks where name like '%.backup'

-- blank row to avoid the brw last row action issue
 insert @rt (display, ord) select '', 'zzz'

 return
end
