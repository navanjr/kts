create proc dbo.glCreateTables2
as
begin
 set nocount on
 exec dbo.logit @@procid, 'Running...'

if not exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[mortgageLinksImported]') and OBJECTPROPERTY(id, N'IsTable') = 1)
create table dbo.mortgageLinksImported (
 id int identity(1,1),
 parcel [nvarchar](24),
 year [numeric](5, 0),
 mortgage_code varchar(10),
 company varchar(50),
 blob varchar(max),
 modified datetime not null default getDate(),
 apiUpdated datetime default null)

 if not exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'temp_mortgageLink' and COLUMN_NAME = 'mortgage_Code')
   alter table temp_mortgageLink add mortgage_Code varchar(10)

if not exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'aamaster' and COLUMN_NAME = 'taxYear')
  alter table aamaster add taxYear [numeric](5, 0)  

-- TAXROLLCORRECTIONS
 if not exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[taxrollCorrections]') and OBJECTPROPERTY(id, N'IsTable') = 1)
  create table taxrollCorrections(
   id int identity(1,1),
   taxrollId int,
   fieldNumber int,
   fieldName varchar(50),
   fieldData varchar(max),
   invoiceId int,
   originalData varchar(max),
   correctionDate int,
   creationdate int default (left(CONVERT([real],getdate(),0),(5))+(36163)),
   creationtime int default ((substring(CONVERT([char],getdate(),(114)),(1),(2))*(360000)+substring(CONVERT([char],getdate(),(114)),(4),(2))*(6000))+substring(CONVERT([char],getdate(),(114)),(7),(2))*(100)),
   ini varchar(50),
   comment varchar(max)    
  )

 if not exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'taxrollCorrections' and COLUMN_NAME = 'comment')
   alter table taxrollCorrections add comment varchar(max)

--alter invoices
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'invoices' and COLUMN_NAME = 'NAME' and character_maximum_length=30)
   alter table invoices alter column NAME nvarchar(40) not null

 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'invoices' and COLUMN_NAME = 'BUSINESSNAME' and character_maximum_length=30)
   alter table invoices alter column BUSINESSNAME nvarchar(40) not null


--alter adtax
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'OWNERNAME' and character_maximum_length=30)
   alter table adtax alter column OWNERNAME nvarchar(40)

 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'BUSINESSNAME' and character_maximum_length=30)
   alter table adtax alter column BUSINESSNAME nvarchar(40)

 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'ORGSCHOOLDISTRICTMAIN' and character_maximum_length=15)
   alter table adtax alter column ORGSCHOOLDISTRICTMAIN nvarchar(20)
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'SCHOOLDISTRICTMAIN' and character_maximum_length=15)
  begin
   IF  EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[AdTax]') AND name = N'Id,OwnerName')
     DROP INDEX [Id,OwnerName] ON [dbo].[AdTax] WITH ( ONLINE = OFF )
   alter table adtax alter column SCHOOLDISTRICTMAIN nvarchar(20)
  end
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'ORGSCHOOLDISTRICTTAXRATE' and character_maximum_length=15)
   alter table adtax alter column ORGSCHOOLDISTRICTTAXRATE nvarchar(20)
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTax' and COLUMN_NAME = 'SCHOOLDISTRICTTAXRATE' and character_maximum_length=15)
   alter table adtax alter column SCHOOLDISTRICTTAXRATE nvarchar(20)

--alter adtaxcheck
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTaxCheck' and COLUMN_NAME = 'ORGSCHOOLDISTRICTMAIN' and character_maximum_length=15)
   alter table adtaxCheck alter column ORGSCHOOLDISTRICTMAIN nvarchar(20)
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTaxCheck' and COLUMN_NAME = 'SCHOOLDISTRICTMAIN' and character_maximum_length=15)
   alter table adtaxCheck alter column SCHOOLDISTRICTMAIN nvarchar(20)
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTaxCheck' and COLUMN_NAME = 'ORGSCHOOLDISTRICTTAXRATE' and character_maximum_length=15)
   alter table adtaxCheck alter column ORGSCHOOLDISTRICTTAXRATE nvarchar(20)
 if exists(SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AdTaxCheck' and COLUMN_NAME = 'SCHOOLDISTRICTTAXRATE' and character_maximum_length=15)
   alter table adtaxCheck alter column SCHOOLDISTRICTTAXRATE nvarchar(20)

IF not EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[AdTax]') AND name = N'Id,OwnerName') 
    CREATE NONCLUSTERED INDEX [Id,OwnerName] ON [dbo].[AdTax] 
    ([ID] ASC,
     [OWNERNAME] ASC)
      INCLUDE ( [RECORDTYPE],
      [ADDITIONNUMBER],
      [TOWNSHIPBLOCK],
      [RANGELOT],
      [FULLPIDNUMBER],
      [ITEMNUMBER],
      [REALTAXYEAR],
      [ADDRESS1],
      [ADDRESS2],
      [CITY],
      [STATE],
      [ZIP1],
      [SCHOOLDISTRICTMAIN],
      [ACRES],
      [MFGHOMEASSESSED],
      [GROSSASSESSED],
      [BASEEXEMPTION],
      [NETASSESSEDVALUE],
      [TOTALTAXRATE],
      [proploc], 
      [LandAssessed],
      [ImprovedAssessed],
      [MiscAssessed],
      [modified],
      [apiUpdated]) 



end