CREATE proc [dbo].[conversion_mikeTaxrollCorrections](
 @mode varchar(50) = 'conversion',
 @method varchar(5) = 'GET',
 @class varchar(50) = null output,
 @code int = 0 output,
 @message varchar(100) = null output,
 @tally int = 0 output,
 @fixProc varchar(100) = null output,
 @guide varchar(100) = null output
) as 
begin
 set nocount on

 if @mode != 'conversion'
  return

 if @method = 'GET'
 begin  
 
  select 
   @class = 'conversion',
   @guide = 'GET|SHOW|FIX',
   @message = 'mike_taxrollCorrection records not found in KTS'

  if not exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[mike_taxrollCorrection]') and OBJECTPROPERTY(id, N'IsTable') = 1)
  begin
   select 
    @tally = 1,  
    @code = 1
   return
  end 

  if exists(select top 10 * from mike_taxrollCorrection) 
   select 
    @tally = COUNT(*),  
    @code = 0
   from adtax
  else
   select 
    @tally = 1,  
    @code = 1

  return
 end

 if @method = 'SHOW'
 begin  

  select * 
  from adtax
  --where taxrollid not in (select accountCode from dbo.glAccounts)

 end

 if @method = 'FIX'
 begin  

  declare
   @mikeTableName varchar(50) = 'ASMNCUR',
   @mikePath varchar(max),
   @sql1 nvarchar(max),
   @sql2 nvarchar(max),
   @sql nvarchar(max),
   @fields nvarchar(max)

  select @mikePath = dbo.settingsF('conversion.mikepathtax','') + '\' + @mikeTableName + '.dbf'

  if exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[mike_taxrollCorrection]') and OBJECTPROPERTY(id, N'IsTable') = 1)
  begin
   exec dbo.logit @@procid, 'Dropping table mike_taxrollCorrection'
   drop table mike_taxrollCorrection
  end

  exec dbo.logit @@procid, 'Creating mike_taxrollCorrection from VFP Drivers...'

 set @sql = 'select 
  cast(a.taxyear as numeric(5,0)) as [TAXYEAR],
  cast(a.itm_nbr as numeric(7,1)) as itemnumber,
  key_suf,
  per_c,
  lv_c,
  imp_c,
  exemp_c,
  net_c
 into mike_taxrollCorrection
 FROM openrowset(''VFPOLEDB'',''' + @mikePath + ''';'''';'''',''SELECT * FROM ' + @mikeTableName + ' where !deleted()'') a'
--71
 exec dbo.logit @@procid, 'Complete'

 exec(@sql)

  
  return

 end

end



