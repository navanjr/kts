create function dbo.glAccountGetFundAccrualCode(@fundcode varchar(50)) returns @rt table(accrualcode varchar(50), fundcode varchar(50)) as 
begin
 
 if exists(select * from glaccounts where accountType = 'ACCRUAL' and accountcode = @fundcode)
  begin
   insert @rt 
     select @fundcode,''
  end

 if exists(select * from glaccounts where accountType = 'FUND' and accountcode = @fundcode)
  begin
   if exists(select * from glaccounts where accountType = 'ACCRUAL' and targetaccountcode = @fundcode)
    begin
     insert @rt
       select accountcode, targetaccountcode from glaccounts where accountType = 'ACCRUAL' and targetaccountcode = @fundcode
    end
   else
    begin
     insert @rt
       select upper(rtrim(@fundcode))+'_AC', @fundcode
    end
  end
 else
  begin
   insert @rt 
     select @fundcode,''
  end 
 return 
end
