create procedure [dbo].[taxReferenceCRUD](
 @taxrollId int,
 @newInvoiceId int = null output
) as
begin

 -- insert tax reference invoice
 if not exists(select * from invoices where taxrollId=@taxrollId)
  begin
   insert invoices ([TAXROLLID],[TYP],[PARCEL],[ITEM],[TAXYEAR],[NAME],[BUSINESSNAME],[POSTDATE],[STATUS],[interestDate])
   select
    [ID],
    [RECORDTYPE],
    [FULLPIDNUMBER],
    [ITEMNUMBER],
    [REALTAXYEAR],
    [OWNERNAME],
    [BUSINESSNAME],
    dbo.clariondate(getdate()),
    '',
    dbo.clariondate('12/31/' + cast([REALTAXYEAR] as varchar))
   from adtax where id = @taxrollId

   set @newInvoiceId = @@identity
   exec dbo.logit @@procid, 'Created new invoice - @newInvoiceId', @newInvoiceId

  end
  else
  begin

   exec dbo.logit @@procid, 'invoice already exists... sorry something happened.  last time it was a hung SQL Transaction. you will need to erase all bad invoices'

  end
end