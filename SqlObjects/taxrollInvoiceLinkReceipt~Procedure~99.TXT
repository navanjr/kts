create procedure dbo.taxrollInvoiceLinkReceipt(
 @taxInquiryId int,
 @receiptId int,
 @forceInterestDate int = null
)
as 
begin

exec dbo.logit @@procid, '@taxInquiryId', @taxInquiryId, '@receiptId', @receiptId 

 -- bail if taxInquiryId is not a tax inquiry object record typ 4003
 if not exists(select * from object where typ in (4003,4030) and id = @taxInquiryId)
  return

 -- bail if receiptId is not a receipt object record typ 4502
 if not exists(select * from object where typ = 4502 and id = @receiptId)
  return

 update receiptLink set invoiceId=invoiceId*-1,receiptId=receiptId*-1 
   where receiptId = @taxInquiryId and dbo.invoiceTotalAR(invoiceId) = 0.00

 update receiptlink set receiptId = @receiptId where receiptId = @taxInquiryId  

 exec dbo.taxrollPenaltyBatch @receiptId, @forceInterestDate = @forceInterestDate

 insert receiptLink (receiptId,invoiceId,methodRate)
  select @receiptId, id, 1.00 from invoices where invoiceId in (select invoiceId from receiptLink where receiptId=@receiptId)
   and (id not in (select invoiceid from receiptlink where isnull(invoiceid,0)<>0) or typ != 'P')

end